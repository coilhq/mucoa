<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1386px" preserveAspectRatio="none" style="width:1736px;height:1386px;background:#FFFFFF;" version="1.1" viewBox="0 0 1736 1386" width="1736px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="1367.4367" style="stroke:#181818;stroke-width:0.5;" width="654.5" x="312" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="573.75" y="19.897">Central-Settlement</text><rect fill="#F9FFF9" height="1367.4367" style="stroke:#181818;stroke-width:0.5;" width="457" x="1267" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1468.5" y="19.897">Storage</text><rect height="901.5346" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1720" x="10" y="386.8341"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="87" x2="87" y1="92.7739" y2="1305.3687"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="335" x2="335" y1="92.7739" y2="1305.3687"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="571" x2="571" y1="92.7739" y2="1305.3687"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="737" x2="737" y1="92.7739" y2="1305.3687"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="900.5" x2="900.5" y1="92.7739" y2="1305.3687"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1338" x2="1338" y1="92.7739" y2="1305.3687"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1553.5" x2="1553.5" y1="92.7739" y2="1305.3687"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1694" x2="1694" y1="92.7739" y2="1305.3687"/><rect fill="#B0D5FF" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="20" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="27" y="80.672">Mojaloop Adapter</text><rect fill="#B0D5FF" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="20" y="1304.3687"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="27" y="1326.3347">Mojaloop Adapter</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="38" x="316" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24" x="323" y="80.672">API</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="38" x="316" y="1304.3687"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24" x="323" y="1326.3347">API</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="520" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="21" x="527" y="80.672">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="552" y="80.672">/ Handler</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="520" y="1304.3687"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="21" x="527" y="1326.3347">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="552" y="1326.3347">/ Handler</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="674" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="51" x="681" y="80.672">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="736" y="80.672">/ Service</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="674" y="1304.3687"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="51" x="681" y="1326.3347">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="736" y="1326.3347">/ Service</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="839.5" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="846.5" y="80.672">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="899.5" y="80.672">/ Facade</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="839.5" y="1304.3687"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="846.5" y="1326.3347">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="899.5" y="1326.3347">/ Facade</text><rect fill="#D5E8D4" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1271" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1278" y="80.672">TigerBeetle Client</text><rect fill="#D5E8D4" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1271" y="1304.3687"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1278" y="1326.3347">TigerBeetle Client</text><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1484.5" y="54.706"/><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1480.5" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1487.5" y="80.672">TigerBeetle Cluster</text><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1484.5" y="1304.3687"/><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1480.5" y="1308.3687"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1487.5" y="1330.3347">TigerBeetle Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1668" y="88.672">MySQL</text><path d="M1676,37.706 C1676,27.706 1694,27.706 1694,27.706 C1694,27.706 1712,27.706 1712,37.706 L1712,63.706 C1712,73.706 1694,73.706 1694,73.706 C1694,73.706 1676,73.706 1676,63.706 L1676,37.706 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1676,37.706 C1676,47.706 1694,47.706 1694,47.706 C1694,47.706 1712,47.706 1712,37.706 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1668" y="1319.3347">MySQL</text><path d="M1676,1333.4367 C1676,1323.4367 1694,1323.4367 1694,1323.4367 C1694,1323.4367 1712,1323.4367 1712,1333.4367 L1712,1359.4367 C1712,1369.4367 1694,1369.4367 1694,1369.4367 C1694,1369.4367 1676,1369.4367 1676,1359.4367 L1676,1333.4367 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1676,1333.4367 C1676,1343.4367 1694,1343.4367 1694,1343.4367 C1694,1343.4367 1712,1343.4367 1712,1333.4367 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M16,107.7739 L16,152.7739 L158,152.7739 L158,117.7739 L148,107.7739 L16,107.7739 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M148,107.7739 L148,117.7739 L158,117.7739 L148,107.7739 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="27.5" cy="122.9799" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="34" y="126.6709">Participant Bank A</text><ellipse cx="27.5" cy="140.686" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="34" y="144.377">Participant Bank B</text><path d="M274,163.186 L274,208.186 L396,208.186 L396,173.186 L386,163.186 L274,163.186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M386,163.186 L386,173.186 L396,173.186 L386,163.186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="280" y="182.083">NodeJS interface</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="280" y="199.789">invokes REST API</text><path d="M472,218.598 L472,263.598 L670,263.598 L670,228.598 L660,218.598 L472,218.598 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M660,218.598 L660,228.598 L670,228.598 L660,218.598 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="478" y="237.495">JSON request decoded &amp; sent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="478" y="255.201">for processing via a handler</text><path d="M630,274.01 L630,319.01 L843,319.01 L843,284.01 L833,274.01 L630,274.01 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M833,274.01 L833,284.01 L843,284.01 L833,274.01 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="636" y="292.907">Domain folder where the service</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="636" y="310.6131">functions are exposed.</text><path d="M774,329.4221 L774,374.4221 L1028,374.4221 L1028,339.4221 L1018,329.4221 L774,329.4221 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1018,329.4221 L1018,339.4221 L1028,339.4221 L1018,329.4221 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="780" y="348.3191">Facade for storing/retrieving data from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="780" y="366.0251">MySQL and TigerBeetle</text><path d="M10,386.8341 L370,386.8341 L370,396.5401 L360,406.5401 L10,406.5401 L10,386.8341 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="901.5346" style="stroke:#000000;stroke-width:1.5;" width="1720" x="10" y="386.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="173" x="25" y="401.7311">Trigger Settlement Event -</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="139" x="201" y="401.7311">createSettlementEvent</text><polygon fill="#181818" points="323,443.9521,333,447.9521,323,451.9521,327,447.9521" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="87" x2="329" y1="447.9521" y2="447.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="94" y="433.2901">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="29" x="105" y="424.4371">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="134" y="424.4371"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="105" y="442.1431">(settlement data)</text><polygon fill="#181818" points="559,493.3642,569,497.3642,559,501.3642,563,497.3642" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="565" y1="497.3642" y2="497.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="342" y="482.7022">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="198" x="353" y="473.8492">/settlements/createSettlementEvent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="551" y="473.8492"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="353" y="491.5552">Handler invoked</text><polygon fill="#181818" points="725,542.7762,735,546.7762,725,550.7762,729,546.7762" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="571" x2="731" y1="546.7762" y2="546.7762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="578" y="532.1142">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="589" y="523.2612">Service layer invoked</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="131" x="589" y="540.9672">settlementEventTrigger</text><polygon fill="#181818" points="889,592.1882,899,596.1882,889,600.1882,893,596.1882" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="737" x2="895" y1="596.1882" y2="596.1882"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="744" y="581.5262">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="755" y="572.6732">Domain to facade</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="129" x="755" y="590.3792">triggerSettlementEvent</text><polygon fill="#181818" points="1682,765.5424,1692,769.5424,1682,773.5424,1686,769.5424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="901" x2="1688" y1="769.5424" y2="769.5424"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="908" y="692.9093">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="919" y="622.0853">Perform the following inserts against the database:</text><ellipse cx="924.5" cy="636.1003" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="58" x="931" y="639.7913">settlement</text><ellipse cx="924.5" cy="653.8063" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="163" x="931" y="657.4973">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="1097" y="657.4973">for each settlement window.</text><ellipse cx="924.5" cy="671.5123" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="172" x="931" y="675.2033">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1106" y="675.2033">Built in TB.</text><ellipse cx="924.5" cy="689.2183" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="149" x="931" y="692.9093">settlementWindowContent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1083" y="692.9093">Built in TB.</text><ellipse cx="924.5" cy="706.9243" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="222" x="931" y="710.6153">settlementWindowContentStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1156" y="710.6153">Built in TB.</text><ellipse cx="924.5" cy="724.6304" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="245" x="931" y="728.3214">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1179" y="728.3214">Built in TB.</text><ellipse cx="924.5" cy="742.3364" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="177" x="931" y="746.0274">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1111" y="746.0274">Built in TB.</text><ellipse cx="924.5" cy="760.0424" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="131" x="931" y="763.7334">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1065" y="763.7334">Built in TB.</text><polygon fill="#181818" points="1326,814.9544,1336,818.9544,1326,822.9544,1330,818.9544" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="901" x2="1332" y1="818.9544" y2="818.9544"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="908" y="804.2924">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="919" y="795.4394">Lookup Txn's to be settled via CS-TB interface:</text><ellipse cx="924.5" cy="809.4544" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="193" x="931" y="813.1454">lookupForSettlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="1127" y="813.1454">- Based on settlementWindowId.</text><polygon fill="#181818" points="1326,988.3086,1336,992.3086,1326,996.3086,1330,992.3086" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="901" x2="1332" y1="992.3086" y2="992.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="908" y="915.6755">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289" x="919" y="844.8514">Create the following accounts via CS-TB interface</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="919" y="862.5575">for the settlement cycle:</text><ellipse cx="924.5" cy="876.5725" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="137" x="931" y="880.2635">HUB_RECONCILIATION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1071" y="880.2635">- Based on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="919" y="897.9695">HUB_ID, HUB_RECONCILIATION and currency.</text><ellipse cx="924.5" cy="911.9845" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="204" x="931" y="915.6755">HUB_MULTILATERAL_SETTLEMENT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1138" y="915.6755">- Based on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="919" y="933.3815">HUB_ID, HUB_MULTILATERAL_SETTLEMENT and currency.</text><ellipse cx="924.5" cy="947.3965" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="77" x="931" y="951.0875">SETTLEMENT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1011" y="951.0875">- Based on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="919" y="968.7936">ParticipantID, SETTLEMENT and currency.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="919" y="986.4996">Settlement account per participant.</text><polygon fill="#181818" points="1542,1037.7206,1552,1041.7206,1542,1045.7206,1546,1041.7206" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1338" x2="1548" y1="1041.7206" y2="1041.7206"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="1345" y="1027.0586">8</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="55" x="1356" y="1018.2056">account's</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1414" y="1018.2056">Distributed to nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1359" y="1035.9116">via the state machine.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1554" x2="1596" y1="1091.1326" y2="1091.1326"/><line style="stroke:#181818;stroke-width:1.0;" x1="1596" x2="1596" y1="1091.1326" y2="1104.1326"/><line style="stroke:#181818;stroke-width:1.0;" x1="1555" x2="1596" y1="1104.1326" y2="1104.1326"/><polygon fill="#181818" points="1565,1100.1326,1555,1104.1326,1565,1108.1326,1561,1104.1326" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="1561" y="1076.4706">9</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1572" y="1067.6176">[ASYNC]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1572" y="1085.3236">Replication via VSR.</text><polygon fill="#181818" points="912,1149.5447,902,1153.5447,912,1157.5447,908,1153.5447" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="906" x2="1337" y1="1153.5447" y2="1153.5447"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="918" y="1138.8827">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="46" x="936" y="1130.0297">account</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="985" y="1130.0297">create error</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1058" y="1130.0297">(none)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="128" x="936" y="1147.7357">(Replicated to 2 nodes)</text><polygon fill="#181818" points="748,1181.2507,738,1185.2507,748,1189.2507,744,1185.2507" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="742" x2="900" y1="1185.2507" y2="1185.2507"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="754" y="1179.4417">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="772" y="1179.4417">Return result</text><polygon fill="#181818" points="582,1212.9567,572,1216.9567,582,1220.9567,578,1216.9567" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="576" x2="736" y1="1216.9567" y2="1216.9567"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="588" y="1211.1477">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="606" y="1211.1477">Return result</text><polygon fill="#181818" points="346,1244.6627,336,1248.6627,346,1252.6627,342,1248.6627" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="340" x2="570" y1="1248.6627" y2="1248.6627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="352" y="1242.8537">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="370" y="1242.8537">Return result</text><polygon fill="#181818" points="98,1276.3687,88,1280.3687,98,1284.3687,94,1280.3687" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="92" x2="334" y1="1280.3687" y2="1280.3687"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="104" y="1274.5597">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="122" y="1274.5597">Return result with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="96" x="232" y="1274.5597">settlementData</text><!--MD5=[12f788237faa3708143c39d94fff2183]
@startuml

participant "Mojaloop Adapter" as dfsp #B0D5FF
note over dfsp
    * Participant Bank A
    * Participant Bank B
end note

box Central-Settlement #FFFFF9
    participant "**API**" as cl_api
    participant "__api__ / Handler" as cs_handler
    participant "__domain__ / Service" as cs_domain
    participant "__models__ / Facade" as cs_facade

note over cl_api
        NodeJS interface
        invokes REST API
    end note

    note over cs_handler
        JSON request decoded & sent
        for processing via a handler
    end note

    note over cs_domain
        Domain folder where the service
        functions are exposed.
    end note

    note over cs_facade
        Facade for storing/retrieving data from
        MySQL and TigerBeetle
    end note
end box

box Storage #F9FFF9
	participant "TigerBeetle Client" as tb_client #D5E8D4
	collections "TigerBeetle Cluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
end box

autonumber
group Trigger Settlement Event - //createSettlementEvent//
    dfsp -> cl_api : //JSON// \n**(settlement data)**
    cl_api -> cs_handler : ///settlements/createSettlementEvent// \nHandler invoked
    cs_handler -> cs_domain : Service layer invoked\n//settlementEventTrigger//
    cs_domain -> cs_facade : Domain to facade\n//triggerSettlementEvent//
    cs_facade -> cl_db : Perform the following inserts against the database:\n*//settlement//\n*//settlementSettlementWindow// for each settlement window.\n*- -//settlementParticipantCurrency//- - Built in TB. \n*- -//settlementWindowContent//- - Built in TB. \n*- -//settlementWindowContentStateChange//- - Built in TB. \n*- -//settlementParticipantCurrencyStateChange//- - Built in TB.\n*- -//settlementWindowStateChange//- - Built in TB.\n*- -//settlementStateChange//- - Built in TB.
    cs_facade -> tb_client : Lookup Txn's to be settled via CS-TB interface:\n*//**lookupForSettlementWindowId**// - Based on settlementWindowId.
    cs_facade -> tb_client : Create the following accounts via CS-TB interface \nfor the settlement cycle:\n*//**HUB_RECONCILIATION**// - Based on \nHUB_ID, HUB_RECONCILIATION and currency.\n*//**HUB_MULTILATERAL_SETTLEMENT**// - Based on \nHUB_ID, HUB_MULTILATERAL_SETTLEMENT and currency.\n*//**SETTLEMENT**// - Based on \nParticipantID, SETTLEMENT and currency.\nSettlement account per participant.
    tb_client -> tb_nodes : //account's// Distributed to nodes\n via the state machine.
    tb_nodes -> tb_nodes : **[ASYNC]**\nReplication via VSR.
    tb_client - -> cs_facade : //account// create error **(none)**\n//(Replicated to 2 nodes)//
    cs_facade - -> cs_domain : Return result
    cs_domain - -> cs_handler : Return result
    cs_handler - -> cl_api : Return result
    cl_api - -> dfsp : Return result with //**settlementData**//
end

@enduml

PlantUML version 1.2022.6(Tue Jun 21 19:34:49 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>