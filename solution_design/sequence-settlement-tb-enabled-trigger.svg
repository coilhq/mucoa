<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="848px" preserveAspectRatio="none" style="width:1027px;height:848px;background:#FFFFFF;" version="1.1" viewBox="0 0 1027 848" width="1027px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="829.3594" style="stroke:#181818;stroke-width:0.5;" width="403" x="211.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="351.5" y="19.4951">Central-Settlement</text><rect fill="#F9FFF9" height="829.3594" style="stroke:#181818;stroke-width:0.5;" width="398.5" x="616.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="788.75" y="19.4951">Storage</text><rect height="433.9766" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1011" x="10" y="317.7734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="82" x2="82" y1="89.9609" y2="768.75"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="233.5" x2="233.5" y1="89.9609" y2="768.75"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="350.5" x2="350.5" y1="89.9609" y2="768.75"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="519.5" x2="519.5" y1="89.9609" y2="768.75"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="683.5" x2="683.5" y1="89.9609" y2="768.75"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="879" x2="879" y1="89.9609" y2="768.75"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="985" x2="985" y1="89.9609" y2="768.75"/><rect fill="#B0D5FF" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="20" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="27" y="78.8848">Mojaloop Adapter</text><rect fill="#B0D5FF" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="20" y="767.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="27" y="789.2832">Mojaloop Adapter</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36" x="215.5" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="22" x="222.5" y="78.8848">API</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36" x="215.5" y="767.75"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="22" x="222.5" y="789.2832">API</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="303.5" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="19" x="310.5" y="78.8848">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="333.5" y="78.8848">/ Handler</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="303.5" y="767.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="19" x="310.5" y="789.2832">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="333.5" y="789.2832">/ Handler</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="428.5" y="39.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="465" y="61.2754">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="435.5" y="78.8848">(domain / service / facade)</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="428.5" y="767.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="465" y="789.2832">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="435.5" y="806.8926">(domain / service / facade)</text><rect fill="#D5E8D4" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="620.5" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="627.5" y="78.8848">TigerBeetle Client</text><rect fill="#D5E8D4" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="620.5" y="767.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="627.5" y="789.2832">TigerBeetle Client</text><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="813" y="53.3516"/><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="809" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="816" y="78.8848">TigerBeetle Cluster</text><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="813" y="767.75"/><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="809" y="771.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="816" y="793.2832">TigerBeetle Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="959" y="86.8848">MySQL</text><path d="M967,36.3516 C967,26.3516 985,26.3516 985,26.3516 C985,26.3516 1003,26.3516 1003,36.3516 L1003,62.3516 C1003,72.3516 985,72.3516 985,72.3516 C985,72.3516 967,72.3516 967,62.3516 L967,36.3516 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M967,36.3516 C967,46.3516 985,46.3516 985,46.3516 C985,46.3516 1003,46.3516 1003,36.3516 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="959" y="782.2832">MySQL</text><path d="M967,795.3594 C967,785.3594 985,785.3594 985,785.3594 C985,785.3594 1003,785.3594 1003,795.3594 L1003,821.3594 C1003,831.3594 985,831.3594 985,831.3594 C985,831.3594 967,831.3594 967,821.3594 L967,795.3594 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M967,795.3594 C967,805.3594 985,805.3594 985,805.3594 C985,805.3594 1003,805.3594 1003,795.3594 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M19,104.9609 L19,146.9609 L146,146.9609 L146,114.9609 L136,104.9609 L19,104.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M136,104.9609 L136,114.9609 L146,114.9609 L136,104.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="25" y="123.4561">Participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="25" y="139.8076">DFSP interactions</text><path d="M170,157.6641 L170,199.6641 L297,199.6641 L297,167.6641 L287,157.6641 L170,157.6641 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M287,157.6641 L287,167.6641 L297,167.6641 L287,157.6641 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="176" y="176.1592">NodeJS interface</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="176" y="192.5107">invokes REST API</text><path d="M266,210.3672 L266,252.3672 L434,252.3672 L434,220.3672 L424,210.3672 L266,210.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M424,210.3672 L424,220.3672 L434,220.3672 L424,210.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="272" y="228.8623">JSON request decoded &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="272" y="245.2139">processed via handler</text><path d="M426,263.0703 L426,305.0703 L613,305.0703 L613,273.0703 L603,263.0703 L426,263.0703 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M603,263.0703 L603,273.0703 L613,273.0703 L603,263.0703 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="432" y="281.5654">Expose service functions &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="432" y="297.917">handle database interactions</text><path d="M10,317.7734 L172,317.7734 L172,326.125 L162,336.125 L10,336.125 L10,317.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="433.9766" style="stroke:#000000;stroke-width:1.5;" width="1011" x="10" y="317.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="117" x="25" y="332.2686">Initiate Settlement</text><polygon fill="#181818" points="221.5,370.8281,231.5,374.8281,221.5,378.8281,225.5,374.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="82.5" x2="227.5" y1="374.8281" y2="374.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="89.5" y="361.7959">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="35" x="100.5" y="353.6201">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="135.5" y="353.6201"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="100.5" y="369.9717">(settlement data)</text><polygon fill="#181818" points="338.5,401.1797,348.5,405.1797,338.5,409.1797,342.5,405.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="233.5" x2="344.5" y1="405.1797" y2="405.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="240.5" y="400.3232">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="251.5" y="400.3232">Invoke handler</text><polygon fill="#181818" points="507.5,431.5313,517.5,435.5313,507.5,439.5313,511.5,435.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="350.5" x2="513.5" y1="435.5313" y2="435.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="357.5" y="430.6748">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="368.5" y="430.6748">Invoke application layer</text><polygon fill="#181818" points="973,478.2344,983,482.2344,973,486.2344,977,482.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="519.5" x2="979" y1="482.2344" y2="482.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="526.5" y="469.2021">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="537.5" y="461.0264">Insert settlement data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="537.5" y="477.3779">(excluding accounts)</text><polygon fill="#181818" points="530.5,524.9375,520.5,528.9375,530.5,532.9375,526.5,528.9375" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="672,524.9375,682,528.9375,672,532.9375,676,528.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="524.5" x2="678" y1="528.9375" y2="528.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="536.5" y="515.9053">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="547.5" y="507.7295">Retrieve settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="547.5" y="524.0811">window transactions</text><polygon fill="#181818" points="672,571.6406,682,575.6406,672,579.6406,676,575.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="519.5" x2="678" y1="575.6406" y2="575.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="526.5" y="562.6084">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="537.5" y="554.4326">Invoke settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="537.5" y="570.7842">account creation</text><polygon fill="#181818" points="695,601.9922,685,605.9922,695,609.9922,691,605.9922" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="867,601.9922,877,605.9922,867,609.9922,871,605.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="689" x2="873" y1="605.9922" y2="605.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="701" y="601.1357">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="712" y="601.1357">Create settlement accounts</text><polygon fill="#181818" points="530.5,632.3438,520.5,636.3438,530.5,640.3438,526.5,636.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="524.5" x2="683" y1="636.3438" y2="636.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="536.5" y="631.4873">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="547.5" y="631.4873">Return result</text><polygon fill="#181818" points="361.5,662.6953,351.5,666.6953,361.5,670.6953,357.5,666.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="355.5" x2="518.5" y1="666.6953" y2="666.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="367.5" y="661.8389">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="378.5" y="661.8389">Return result</text><polygon fill="#181818" points="244.5,693.0469,234.5,697.0469,244.5,701.0469,240.5,697.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="238.5" x2="349.5" y1="697.0469" y2="697.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="250.5" y="692.1904">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="268.5" y="692.1904">Return result</text><polygon fill="#181818" points="93.5,739.75,83.5,743.75,93.5,747.75,89.5,743.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="87.5" x2="232.5" y1="743.75" y2="743.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="99.5" y="730.7178">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="117.5" y="722.542">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="63" x="159.5" y="722.542">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="222.5" y="722.542"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="117.5" y="738.8936">result</text><!--MD5=[d22db44b25f1f9ef851f5fd565cce00e]
@startuml

participant "Mojaloop Adapter" as dfsp #B0D5FF
note over dfsp
    Participant
    DFSP interactions
end note

box Central-Settlement #FFFFF9
    participant "**API**" as cs_api
    participant "__api__ / Handler" as cs_handler
    participant "Application Layer\n(domain / service / facade)" as cs_domain

note over cs_api
        NodeJS interface
        invokes REST API
    end note

    note over cs_handler
        JSON request decoded &
        processed via handler
    end note

    note over cs_domain
        Expose service functions &
        handle database interactions
    end note

end box

box Storage #F9FFF9
	participant "TigerBeetle Client" as tb_client #D5E8D4
	collections "TigerBeetle Cluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
end box

autonumber
group Initiate Settlement
    dfsp -> cs_api : //JSON// \n**(settlement data)**
    cs_api -> cs_handler : Invoke handler
    cs_handler -> cs_domain : Invoke application layer
    cs_domain -> cl_db : Insert settlement data \n(excluding accounts)
    cs_domain <- -> tb_client : Retrieve settlement \nwindow transactions
    cs_domain -> tb_client : Invoke settlement \naccount creation
    tb_client <- -> tb_nodes : Create settlement accounts
    tb_client - -> cs_domain : Return result
    cs_domain - -> cs_handler : Return result
    cs_handler - -> cs_api : Return result
    cs_api - -> dfsp : Return //**settlement**// \nresult
end

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CAT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>