<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1017px" preserveAspectRatio="none" style="width:1098px;height:1017px;background:#FFFFFF;" version="1.1" viewBox="0 0 1098 1017" width="1098px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="998.8203" style="stroke:#181818;stroke-width:0.5;" width="403" x="207.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="347.5" y="19.4951">Central-Settlement</text><rect fill="#F9FFF9" height="998.8203" style="stroke:#181818;stroke-width:0.5;" width="402.5" x="684" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="858.25" y="19.4951">Storage</text><rect height="603.4375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1082.5" x="10" y="317.7734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="82" x2="82" y1="89.9609" y2="938.2109"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="229.5" x2="229.5" y1="89.9609" y2="938.2109"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="346.5" x2="346.5" y1="89.9609" y2="938.2109"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="515.5" x2="515.5" y1="89.9609" y2="938.2109"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="751" x2="751" y1="89.9609" y2="938.2109"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="950.5" x2="950.5" y1="89.9609" y2="938.2109"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1056.5" x2="1056.5" y1="89.9609" y2="938.2109"/><rect fill="#B0D5FF" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="20" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="27" y="78.8848">Mojaloop Adapter</text><rect fill="#B0D5FF" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="20" y="937.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="27" y="958.7441">Mojaloop Adapter</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36" x="211.5" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="22" x="218.5" y="78.8848">API</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36" x="211.5" y="937.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="22" x="218.5" y="958.7441">API</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="299.5" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="19" x="306.5" y="78.8848">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="329.5" y="78.8848">/ Handler</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="299.5" y="937.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="19" x="306.5" y="958.7441">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="329.5" y="958.7441">/ Handler</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="424.5" y="39.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="461" y="61.2754">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="431.5" y="78.8848">(domain / service / facade)</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="424.5" y="937.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="461" y="958.7441">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="431.5" y="976.3535">(domain / service / facade)</text><rect fill="#D5E8D4" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="688" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="695" y="78.8848">TigerBeetle Client</text><rect fill="#D5E8D4" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="688" y="937.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="695" y="958.7441">TigerBeetle Client</text><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="884.5" y="53.3516"/><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="880.5" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="887.5" y="78.8848">TigerBeetle Cluster</text><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="884.5" y="937.2109"/><rect fill="#D5E8D4" height="31.6094" style="stroke:#181818;stroke-width:0.5;" width="136" x="880.5" y="941.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="887.5" y="962.7441">TigerBeetle Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1030.5" y="86.8848">MySQL</text><path d="M1038.5,36.3516 C1038.5,26.3516 1056.5,26.3516 1056.5,26.3516 C1056.5,26.3516 1074.5,26.3516 1074.5,36.3516 L1074.5,62.3516 C1074.5,72.3516 1056.5,72.3516 1056.5,72.3516 C1056.5,72.3516 1038.5,72.3516 1038.5,62.3516 L1038.5,36.3516 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1038.5,36.3516 C1038.5,46.3516 1056.5,46.3516 1056.5,46.3516 C1056.5,46.3516 1074.5,46.3516 1074.5,36.3516 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1030.5" y="951.7441">MySQL</text><path d="M1038.5,964.8203 C1038.5,954.8203 1056.5,954.8203 1056.5,954.8203 C1056.5,954.8203 1074.5,954.8203 1074.5,964.8203 L1074.5,990.8203 C1074.5,1000.8203 1056.5,1000.8203 1056.5,1000.8203 C1056.5,1000.8203 1038.5,1000.8203 1038.5,990.8203 L1038.5,964.8203 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1038.5,964.8203 C1038.5,974.8203 1056.5,974.8203 1056.5,974.8203 C1056.5,974.8203 1074.5,974.8203 1074.5,964.8203 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M19,104.9609 L19,146.9609 L146,146.9609 L146,114.9609 L136,104.9609 L19,104.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M136,104.9609 L136,114.9609 L146,114.9609 L136,104.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="25" y="123.4561">Hub operator or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="25" y="139.8076">DFSP interactions</text><path d="M166,157.6641 L166,199.6641 L293,199.6641 L293,167.6641 L283,157.6641 L166,157.6641 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M283,157.6641 L283,167.6641 L293,167.6641 L283,157.6641 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="172" y="176.1592">NodeJS interface</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="172" y="192.5107">invokes REST API</text><path d="M262,210.3672 L262,252.3672 L430,252.3672 L430,220.3672 L420,210.3672 L262,210.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M420,210.3672 L420,220.3672 L430,220.3672 L420,210.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="268" y="228.8623">JSON request decoded &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="268" y="245.2139">processed via handler</text><path d="M422,263.0703 L422,305.0703 L609,305.0703 L609,273.0703 L599,263.0703 L422,263.0703 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M599,263.0703 L599,273.0703 L609,273.0703 L599,263.0703 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="428" y="281.5654">Expose service functions &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="428" y="297.917">handle database interactions</text><path d="M10,317.7734 L173,317.7734 L173,326.125 L163,336.125 L10,336.125 L10,317.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="603.4375" style="stroke:#000000;stroke-width:1.5;" width="1082.5" x="10" y="317.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="25" y="332.2686">Update Settlement</text><polygon fill="#181818" points="217.5,370.8281,227.5,374.8281,217.5,378.8281,221.5,374.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="82.5" x2="223.5" y1="374.8281" y2="374.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="89.5" y="361.7959">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="35" x="100.5" y="353.6201">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="135.5" y="353.6201"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="100.5" y="369.9717">(settlement data)</text><polygon fill="#181818" points="334.5,401.1797,344.5,405.1797,334.5,409.1797,338.5,405.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="229.5" x2="340.5" y1="405.1797" y2="405.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="236.5" y="400.3232">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="247.5" y="400.3232">Invoke handler</text><polygon fill="#181818" points="503.5,431.5313,513.5,435.5313,503.5,439.5313,507.5,435.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="346.5" x2="509.5" y1="435.5313" y2="435.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="353.5" y="430.6748">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="364.5" y="430.6748">Invoke application layer</text><polygon fill="#181818" points="526.5,478.2344,516.5,482.2344,526.5,486.2344,522.5,482.2344" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1044.5,478.2344,1054.5,482.2344,1044.5,486.2344,1048.5,482.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="520.5" x2="1050.5" y1="482.2344" y2="482.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="532.5" y="469.2021">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="543.5" y="461.0264">Retrieve settlement data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="543.5" y="477.3779">(excluding accounts)</text><polygon fill="#181818" points="526.5,524.9375,516.5,528.9375,526.5,532.9375,522.5,528.9375" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="739.5,524.9375,749.5,528.9375,739.5,532.9375,743.5,528.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="520.5" x2="745.5" y1="528.9375" y2="528.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="532.5" y="515.9053">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="543.5" y="507.7295">Retrieve accounts for all</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="55" x="685.5" y="507.7295">Transfers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="740.5" y="507.7295"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="543.5" y="524.0811">for a settlement window</text><polygon fill="#181818" points="1044.5,571.6406,1054.5,575.6406,1044.5,579.6406,1048.5,575.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="515.5" x2="1050.5" y1="575.6406" y2="575.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="522.5" y="562.6084">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="533.5" y="554.4326">Update settlement data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="533.5" y="570.7842">(excluding accounts)</text><line style="stroke:#181818;stroke-width:1.0;" x1="515.5" x2="557.5" y1="622.3438" y2="622.3438"/><line style="stroke:#181818;stroke-width:1.0;" x1="557.5" x2="557.5" y1="622.3438" y2="635.3438"/><line style="stroke:#181818;stroke-width:1.0;" x1="516.5" x2="557.5" y1="635.3438" y2="635.3438"/><polygon fill="#181818" points="526.5,631.3438,516.5,635.3438,526.5,639.3438,522.5,635.3438" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="522.5" y="609.3115">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="533.5" y="601.1357">Settlement state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="533.5" y="617.4873">processing</text><polygon fill="#181818" points="739.5,678.0469,749.5,682.0469,739.5,686.0469,743.5,682.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="515.5" x2="745.5" y1="682.0469" y2="682.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="522.5" y="669.0146">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="533.5" y="660.8389">Invoke account creation based on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="533.5" y="677.1904">settlement state of each</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="677.5" y="677.1904">Transfer</text><polygon fill="#181818" points="762.5,724.75,752.5,728.75,762.5,732.75,758.5,728.75" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="938.5,724.75,948.5,728.75,938.5,732.75,942.5,728.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="756.5" x2="944.5" y1="728.75" y2="728.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="768.5" y="715.7178">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="779.5" y="707.542">Create settlement accounts</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="779.5" y="723.8936">&amp; return result</text><polygon fill="#181818" points="526.5,755.1016,516.5,759.1016,526.5,763.1016,522.5,759.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="520.5" x2="750.5" y1="759.1016" y2="759.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="532.5" y="754.2451">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="550.5" y="754.2451">Return settlement result</text><polygon fill="#181818" points="526.5,801.8047,516.5,805.8047,526.5,809.8047,522.5,805.8047" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1044.5,801.8047,1054.5,805.8047,1044.5,809.8047,1048.5,805.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="520.5" x2="1050.5" y1="805.8047" y2="805.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="532.5" y="792.7725">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="550.5" y="784.5967">Update final settlement state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="550.5" y="800.9482">&amp; return result</text><polygon fill="#181818" points="357.5,832.1563,347.5,836.1563,357.5,840.1563,353.5,836.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="351.5" x2="514.5" y1="836.1563" y2="836.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="363.5" y="831.2998">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="381.5" y="831.2998">Return result</text><polygon fill="#181818" points="240.5,862.5078,230.5,866.5078,240.5,870.5078,236.5,866.5078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="234.5" x2="345.5" y1="866.5078" y2="866.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="246.5" y="861.6514">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="264.5" y="861.6514">Return result</text><polygon fill="#181818" points="93.5,909.2109,83.5,913.2109,93.5,917.2109,89.5,913.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="87.5" x2="228.5" y1="913.2109" y2="913.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="99.5" y="900.1787">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="117.5" y="892.0029">Return result with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="90" x="117.5" y="908.3545">settlementData</text><!--MD5=[0c5ac3d9f6770a919c24ecf118debef0]
@startuml

participant "Mojaloop Adapter" as dfsp #B0D5FF
note over dfsp
    Hub operator or
    DFSP interactions
end note

box Central-Settlement #FFFFF9
    participant "**API**" as cl_api
    participant "__api__ / Handler" as cs_handler
    participant "Application Layer\n(domain / service / facade)" as cs_domain
    'participant "__models__ / Facade" as cs_facade

note over cl_api
        NodeJS interface
        invokes REST API
    end note

    note over cs_handler
        JSON request decoded &
        processed via handler
    end note

    note over cs_domain
        Expose service functions &
        handle database interactions
    end note

end box

box Storage #F9FFF9
	participant "TigerBeetle Client" as tb_client #D5E8D4
	collections "TigerBeetle Cluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
end box

autonumber
group Update Settlement
    dfsp -> cl_api : //JSON// \n**(settlement data)**
    cl_api -> cs_handler : Invoke handler
    cs_handler -> cs_domain : Invoke application layer
    cs_domain <- -> cl_db : Retrieve settlement data \n(excluding accounts)
    cs_domain <- -> tb_client : Retrieve accounts for all //Transfers// \nfor a settlement window
    cs_domain -> cl_db : Update settlement data \n(excluding accounts)
    cs_domain -> cs_domain : Settlement state \nprocessing
    cs_domain -> tb_client : Invoke account creation based on \nsettlement state of each //Transfer//
    tb_client <- -> tb_nodes : Create settlement accounts \n& return result
    tb_client - -> cs_domain : Return settlement result
    cs_domain <- -> cl_db : Update final settlement state \n& return result
    cs_domain - -> cs_handler : Return result
    cs_handler - -> cl_api : Return result
    cl_api - -> dfsp : Return result with \n//**settlementData**//
end

@enduml

@startuml

participant "Mojaloop Adapter" as dfsp #B0D5FF
note over dfsp
    Hub operator or
    DFSP interactions
end note

box Central-Settlement #FFFFF9
    participant "**API**" as cl_api
    participant "__api__ / Handler" as cs_handler
    participant "Application Layer\n(domain / service / facade)" as cs_domain

note over cl_api
        NodeJS interface
        invokes REST API
    end note

    note over cs_handler
        JSON request decoded &
        processed via handler
    end note

    note over cs_domain
        Expose service functions &
        handle database interactions
    end note

end box

box Storage #F9FFF9
	participant "TigerBeetle Client" as tb_client #D5E8D4
	collections "TigerBeetle Cluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
end box

autonumber
group Update Settlement
    dfsp -> cl_api : //JSON// \n**(settlement data)**
    cl_api -> cs_handler : Invoke handler
    cs_handler -> cs_domain : Invoke application layer
    cs_domain <- -> cl_db : Retrieve settlement data \n(excluding accounts)
    cs_domain <- -> tb_client : Retrieve accounts for all //Transfers// \nfor a settlement window
    cs_domain -> cl_db : Update settlement data \n(excluding accounts)
    cs_domain -> cs_domain : Settlement state \nprocessing
    cs_domain -> tb_client : Invoke account creation based on \nsettlement state of each //Transfer//
    tb_client <- -> tb_nodes : Create settlement accounts \n& return result
    tb_client - -> cs_domain : Return settlement result
    cs_domain <- -> cl_db : Update final settlement state \n& return result
    cs_domain - -> cs_handler : Return result
    cs_handler - -> cl_api : Return result
    cl_api - -> dfsp : Return result with \n//**settlementData**//
end

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CAT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>