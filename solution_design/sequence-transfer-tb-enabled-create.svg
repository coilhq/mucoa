<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2113px" preserveAspectRatio="none" style="width:1913px;height:2113px;background:#FFFFFF;" version="1.1" viewBox="0 0 1913 2113" width="1913px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="2101.6875" style="stroke:#181818;stroke-width:0.5;" width="724.5" x="345" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="650.75" y="18.0669">Central-Ledger</text><rect fill="#F9FFF9" height="2101.6875" style="stroke:#181818;stroke-width:0.5;" width="583.5" x="1307" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="57" x="1567.75" y="18.0669">Storage</text><rect height="1670.7656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1886.5" x="10" y="340.625"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="86" x2="86" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="369" x2="369" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="573" x2="573" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="766" x2="766" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="999.5" x2="999.5" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1378" x2="1378" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1610.5" x2="1610.5" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1777.5" x2="1777.5" y1="87.4297" y2="2028.3906"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1863.5" x2="1863.5" y1="87.4297" y2="2028.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="20" y="84.1279">Mojaloop Adapter</text><ellipse cx="86" cy="19.6328" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M86,27.6328 L86,54.6328 M73,35.6328 L99,35.6328 M86,54.6328 L73,69.6328 M86,54.6328 L99,69.6328 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="20" y="2040.3857">Mojaloop Adapter</text><ellipse cx="86" cy="2052.1875" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M86,2060.1875 L86,2087.1875 M73,2068.1875 L99,2068.1875 M86,2087.1875 L73,2102.1875 M86,2087.1875 L99,2102.1875 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="40" x="349" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="26" x="356" y="76.1279">API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="40" x="349" y="2027.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="26" x="356" y="2047.3857">API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="520" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="22" x="527" y="76.1279">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="553" y="76.1279">/ Handler</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="520" y="2027.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="22" x="527" y="2047.3857">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="553" y="2047.3857">/ Handler</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="699" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="54" x="706" y="76.1279">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="764" y="76.1279">/ Service</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="699" y="2027.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="54" x="706" y="2047.3857">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="764" y="2047.3857">/ Service</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="934.5" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="52" x="941.5" y="76.1279">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="997.5" y="76.1279">/ Facade</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="934.5" y="2027.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="52" x="941.5" y="2047.3857">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="997.5" y="2047.3857">/ Facade</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="1311" y="84.1279">TigerBeetle Client</text><ellipse cx="1378" cy="55.1328" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="1374,43.1328,1380,38.1328,1378,43.1328,1380,48.1328,1374,43.1328" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="1311" y="2040.3857">TigerBeetle Client</text><ellipse cx="1378" cy="2059.6875" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="1374,2047.6875,1380,2042.6875,1378,2047.6875,1380,2052.6875,1374,2047.6875" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="151" x="1537.5" y="52.1328"/><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="151" x="1533.5" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1540.5" y="76.1279">TigerBeetle Cluster</text><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="151" x="1537.5" y="2027.3906"/><rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="151" x="1533.5" y="2031.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1540.5" y="2051.3857">TigerBeetle Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="1724.5" y="84.1279">central-ledger</text><path d="M1760,35.1328 C1760,25.1328 1778,25.1328 1778,25.1328 C1778,25.1328 1796,25.1328 1796,35.1328 L1796,61.1328 C1796,71.1328 1778,71.1328 1778,71.1328 C1778,71.1328 1760,71.1328 1760,61.1328 L1760,35.1328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1760,35.1328 C1760,45.1328 1778,45.1328 1778,45.1328 C1778,45.1328 1796,45.1328 1796,35.1328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="1724.5" y="2040.3857">central-ledger</text><path d="M1760,2053.6875 C1760,2043.6875 1778,2043.6875 1778,2043.6875 C1778,2043.6875 1796,2043.6875 1796,2053.6875 L1796,2079.6875 C1796,2089.6875 1778,2089.6875 1778,2089.6875 C1778,2089.6875 1760,2089.6875 1760,2079.6875 L1760,2053.6875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1760,2053.6875 C1760,2063.6875 1778,2063.6875 1778,2063.6875 C1778,2063.6875 1796,2063.6875 1796,2053.6875 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="1841.5" y="84.1279">Redis</text><path d="M1846,35.1328 C1846,25.1328 1864,25.1328 1864,25.1328 C1864,25.1328 1882,25.1328 1882,35.1328 L1882,61.1328 C1882,71.1328 1864,71.1328 1864,71.1328 C1864,71.1328 1846,71.1328 1846,61.1328 L1846,35.1328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1846,35.1328 C1846,45.1328 1864,45.1328 1864,45.1328 C1864,45.1328 1882,45.1328 1882,35.1328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="1841.5" y="2040.3857">Redis</text><path d="M1846,2053.6875 C1846,2043.6875 1864,2043.6875 1864,2043.6875 C1864,2043.6875 1882,2043.6875 1882,2053.6875 L1882,2079.6875 C1882,2089.6875 1864,2089.6875 1864,2089.6875 C1864,2089.6875 1846,2089.6875 1846,2079.6875 L1846,2053.6875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1846,2053.6875 C1846,2063.6875 1864,2063.6875 1864,2063.6875 C1864,2063.6875 1882,2063.6875 1882,2053.6875 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M9,102.4297 L9,142.4297 L163,142.4297 L163,112.4297 L153,102.4297 L9,102.4297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M153,102.4297 L153,112.4297 L163,112.4297 L153,102.4297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="20.5" cy="115.0625" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="28" y="119.4966">Participant Bank A</text><ellipse cx="20.5" cy="130.1953" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="28" y="134.6294">Participant Bank B</text><path d="M264,152.6953 L264,177.6953 L473,177.6953 L473,162.6953 L463,152.6953 L264,152.6953 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M463,152.6953 L463,162.6953 L473,162.6953 L463,152.6953 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="270" y="169.7622">REST API deployed in NodeJS</text><path d="M456,187.8281 L456,227.8281 L690,227.8281 L690,197.8281 L680,187.8281 L456,187.8281 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M680,187.8281 L680,197.8281 L690,197.8281 L680,187.8281 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="462" y="204.895">JSON request decoded and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="462" y="220.0278">sent for processing via a handler</text><path d="M649,238.0938 L649,278.0938 L883,278.0938 L883,248.0938 L873,238.0938 L649,238.0938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M873,238.0938 L873,248.0938 L883,248.0938 L873,238.0938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="655" y="255.1606">Domain folder where the service</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="655" y="270.2935">functions are exposed.</text><path d="M863,288.3594 L863,328.3594 L1136,328.3594 L1136,298.3594 L1126,288.3594 L863,288.3594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1126,288.3594 L1126,298.3594 L1136,298.3594 L1126,288.3594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="869" y="305.4263">Facade for storing/retrieving data from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="869" y="320.5591">MySQL and TigerBeetle</text><path d="M10,340.625 L247,340.625 L247,347.7578 L237,357.7578 L10,357.7578 L10,340.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1670.7656" style="stroke:#000000;stroke-width:1.5;" width="1886.5" x="10" y="340.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="192" x="25" y="353.6919">Create Transfer (2-Phase)</text><polygon fill="#181818" points="357,390.0234,367,394.0234,357,398.0234,361,394.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="86" x2="363" y1="394.0234" y2="394.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="93" y="381.3911">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="32" x="106" y="373.8247">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="138" y="373.8247"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="109" x="106" y="388.9575">(transfer data)</text><polygon fill="#181818" points="561,434.2891,571,438.2891,561,442.2891,565,438.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="369" x2="567" y1="438.2891" y2="438.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="376" y="425.6567">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="163" x="389" y="418.0903">/jmeter/transfers/prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="552" y="418.0903"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="389" y="433.2231">Handler invoked</text><polygon fill="#181818" points="754,463.4219,764,467.4219,754,471.4219,758,467.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="573" x2="760" y1="467.4219" y2="467.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="580" y="462.356">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="593" y="462.356">Service layer invoked</text><polygon fill="#181818" points="988,492.5547,998,496.5547,988,500.5547,992,496.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="766" x2="994" y1="496.5547" y2="496.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="773" y="491.4888">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="786" y="491.4888">Domain to facade</text><polygon fill="#181818" points="1766,627.6172,1776,631.6172,1766,635.6172,1770,631.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1772" y1="631.6172" y2="631.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1007" y="573.5864">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362" x="1020" y="520.6216">Perform the following validations against the database:</text><ellipse cx="1025.5" cy="531.3203" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="230" x="1033" y="535.7544">validateFspiopSourceMatchesPayer</text><ellipse cx="1025.5" cy="546.4531" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="179" x="1033" y="550.8872">validateParticipantByName</text><ellipse cx="1025.5" cy="561.5859" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="296" x="1033" y="566.02">validatePositionAccountByNameAndCurrency</text><ellipse cx="1025.5" cy="576.7188" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="179" x="1033" y="581.1528">validateParticipantByName</text><ellipse cx="1025.5" cy="591.8516" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="104" x="1033" y="596.2856">validateAmount</text><ellipse cx="1025.5" cy="606.9844" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="206" x="1033" y="611.4185">validateConditionAndExpiration</text><ellipse cx="1025.5" cy="622.1172" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="141" x="1033" y="626.5513">validateDifferentDfsp</text><polygon fill="#181818" points="1852,671.8828,1862,675.8828,1852,679.8828,1856,675.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1858" y1="675.8828" y2="675.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1007" y="663.2505">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="1020" y="655.6841">Lookup participant data by</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="37" x="1020" y="670.8169">name</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1057" y="670.8169">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="84" x="1065" y="670.8169">account type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="1153" y="670.8169">(POSITION) and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="56" x="1257" y="670.8169">currency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1313" y="670.8169">.</text><polygon fill="#181818" points="1766,701.0156,1776,705.0156,1766,709.0156,1770,705.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1000" x2="1772" y1="705.0156" y2="705.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="516" x="1007" y="699.9497">If the participant data is not available in Redis, a database lookup is performed</text><polygon fill="#181818" points="1852,730.1484,1862,734.1484,1852,738.1484,1856,734.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1000" x2="1858" y1="734.1484" y2="734.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="1007" y="729.0825">Data looked up is now stored in Redis.</text><polygon fill="#181818" points="1366,759.2813,1376,763.2813,1366,767.2813,1370,763.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1372" y1="763.2813" y2="763.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1007" y="758.2153">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1020" y="758.2153">Pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="54" x="1076" y="758.2153">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="1134" y="758.2153">requested via the CL-TB interface.</text><polygon fill="#181818" points="1599,803.5469,1609,807.5469,1599,811.5469,1603,807.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1378" x2="1605" y1="807.5469" y2="807.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1385" y="794.9146">8</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="51" x="1398" y="787.3481">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="1453" y="787.3481">Distributed to nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1402" y="802.481">via the state machine.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1611" x2="1653" y1="836.6797" y2="836.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="1653" x2="1653" y1="836.6797" y2="849.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="1612" x2="1653" y1="849.6797" y2="849.6797"/><polygon fill="#181818" points="1622,845.6797,1612,849.6797,1622,853.6797,1618,849.6797" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1618" y="831.6138">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="1631" y="831.6138">Replication via VSR.</text><polygon fill="#181818" points="1011,874.8125,1001,878.8125,1011,882.8125,1007,878.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1005" x2="1377" y1="878.8125" y2="878.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1017" y="873.7466">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="51" x="1039" y="873.7466">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="1094" y="873.7466">create error</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="48" x="1174" y="873.7466">(none)</text><polygon fill="#181818" points="777,903.9453,767,907.9453,777,911.9453,773,907.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="771" x2="999" y1="907.9453" y2="907.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="783" y="902.8794">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="805" y="902.8794">Return result</text><polygon fill="#181818" points="584,933.0781,574,937.0781,584,941.0781,580,937.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="578" x2="765" y1="937.0781" y2="937.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="590" y="932.0122">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="612" y="932.0122">Return result</text><polygon fill="#181818" points="380,962.2109,370,966.2109,380,970.2109,376,966.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="374" x2="572" y1="966.2109" y2="966.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="386" y="961.145">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="408" y="961.145">Return result</text><polygon fill="#181818" points="97,991.3438,87,995.3438,97,999.3438,93,995.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="91" x2="368" y1="995.3438" y2="995.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="103" y="990.2778">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="125" y="990.2778">Return result with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="73" x="245" y="990.2778">transferId</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1906.5" x="0" y="1023.9102"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1906.5" y1="1023.9102" y2="1023.9102"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1906.5" y1="1026.9102" y2="1026.9102"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="320" x="793.25" y="1013.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301" x="799.25" y="1029.4106">Asynchronous Database Activities START</text><polygon fill="#181818" points="1766,1078.7422,1776,1082.7422,1766,1086.7422,1770,1082.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1772" y1="1082.7422" y2="1082.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1007" y="1070.1099">15</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="1029" y="1062.5435">[ASYNC 1.1]</text><ellipse cx="1034.5" cy="1073.2422" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="153" x="1042" y="1077.6763">transferDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="1199" y="1077.6763">DB record created.</text><polygon fill="#181818" points="1766,1198.6719,1776,1202.6719,1766,1206.6719,1770,1202.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1772" y1="1202.6719" y2="1202.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1007" y="1152.2075">16</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="1029" y="1106.8091">[ASYNC 1.2]</text><ellipse cx="1034.5" cy="1117.5078" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="51" x="1042" y="1121.9419">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1093" y="1121.9419">,</text><ellipse cx="1034.5" cy="1132.6406" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="121" x="1042" y="1137.0747">transferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1163" y="1137.0747">,</text><ellipse cx="1034.5" cy="1147.7734" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="60" x="1042" y="1152.2075">ilpPacket</text><ellipse cx="1034.5" cy="1162.9063" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="134" x="1042" y="1167.3403">transferStateChange</text><ellipse cx="1034.5" cy="1178.0391" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="115" x="1042" y="1182.4731">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="1029" y="1197.606">Database records created.</text><polygon fill="#181818" points="1011,1242.9375,1001,1246.9375,1011,1250.9375,1007,1246.9375" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1766,1242.9375,1776,1246.9375,1766,1250.9375,1770,1246.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1005" x2="1772" y1="1246.9375" y2="1246.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1017" y="1234.3052">17</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="1039" y="1226.7388">[ASYNC 1.3]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="1043" y="1241.8716">Database transaction committed.</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1906.5" x="0" y="1275.5039"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1906.5" y1="1275.5039" y2="1275.5039"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1906.5" y1="1278.5039" y2="1278.5039"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="312" x="797.25" y="1264.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="293" x="803.25" y="1281.0044">Asynchronous Database Activities STOP</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1906.5" x="0" y="1388.6367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1906.5" y1="1388.6367" y2="1388.6367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1906.5" y1="1391.6367" y2="1391.6367"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="160" x="873.25" y="1378.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141" x="879.25" y="1394.1372">Transfer Fulfilment</text><polygon fill="#181818" points="357,1443.4688,367,1447.4688,357,1451.4688,361,1447.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="86" x2="363" y1="1447.4688" y2="1447.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="93" y="1434.8364">18</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="32" x="115" y="1427.27">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="147" y="1427.27"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="115" y="1442.4028">(fulfil transfer data with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="73" x="274" y="1442.4028">transferId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="347" y="1442.4028">)</text><polygon fill="#181818" points="561,1487.7344,571,1491.7344,561,1495.7344,565,1491.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="369" x2="567" y1="1491.7344" y2="1491.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="376" y="1479.1021">19</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="143" x="398" y="1471.5356">/jmeter/transfers/fulfil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="541" y="1471.5356"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="398" y="1486.6685">Handler invoked.</text><polygon fill="#181818" points="754,1532,764,1536,754,1540,758,1536" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="573" x2="760" y1="1536" y2="1536"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="580" y="1523.3677">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="602" y="1515.8013">Service layer invoked</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="147" x="602" y="1530.9341">handlePayeeResponse</text><polygon fill="#181818" points="988,1576.2656,998,1580.2656,988,1584.2656,992,1580.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="766" x2="994" y1="1580.2656" y2="1580.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="773" y="1567.6333">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="795" y="1560.0669">Domain to facade</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="188" x="795" y="1575.1997">savePayeeTransferResponse</text><polygon fill="#181818" points="1766,1605.3984,1776,1609.3984,1766,1613.3984,1770,1609.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1772" y1="1609.3984" y2="1609.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1007" y="1604.3325">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="1029" y="1604.3325">New Database transaction for fulfillment.</text><polygon fill="#181818" points="1766,1634.5313,1776,1638.5313,1766,1642.5313,1770,1638.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1772" y1="1638.5313" y2="1638.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1007" y="1633.4653">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="1029" y="1633.4653">Obtain</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="151" x="1076" y="1633.4653">settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="1231" y="1633.4653">for window where state is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="1403" y="1633.4653">OPEN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1444" y="1633.4653">.</text><polygon fill="#181818" points="1366,1663.6641,1376,1667.6641,1366,1671.6641,1370,1667.6641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1372" y1="1667.6641" y2="1667.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1007" y="1662.5981">24</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="54" x="1029" y="1662.5981">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="1087" y="1662.5981">posting requested via the CL-TB interface.</text><polygon fill="#181818" points="1599,1707.9297,1609,1711.9297,1599,1715.9297,1603,1711.9297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1378" x2="1605" y1="1711.9297" y2="1711.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1385" y="1699.2974">25</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="51" x="1407" y="1691.731">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="1462" y="1691.731">Distributed to nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1411" y="1706.8638">via the state machine.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1611" x2="1653" y1="1741.0625" y2="1741.0625"/><line style="stroke:#181818;stroke-width:1.0;" x1="1653" x2="1653" y1="1741.0625" y2="1754.0625"/><line style="stroke:#181818;stroke-width:1.0;" x1="1612" x2="1653" y1="1754.0625" y2="1754.0625"/><polygon fill="#181818" points="1622,1750.0625,1612,1754.0625,1622,1758.0625,1618,1754.0625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1618" y="1735.9966">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="1640" y="1735.9966">Replication via VSR.</text><polygon fill="#181818" points="1011,1779.1953,1001,1783.1953,1011,1787.1953,1007,1783.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1005" x2="1377" y1="1783.1953" y2="1783.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1017" y="1778.1294">27</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="51" x="1039" y="1778.1294">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1094" y="1778.1294">posting create error</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="48" x="1226" y="1778.1294">(none)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1274" y="1778.1294">.</text><polygon fill="#181818" points="1766,1853.7266,1776,1857.7266,1766,1861.7266,1770,1857.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1772" y1="1857.7266" y2="1857.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1007" y="1829.9614">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="1029" y="1807.2622">Create</text><ellipse cx="1034.5" cy="1817.9609" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="117" x="1042" y="1822.395">transferFulfilment</text><ellipse cx="1034.5" cy="1833.0938" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="134" x="1042" y="1837.5278">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="1029" y="1852.6606">Database records.</text><polygon fill="#181818" points="1766,1882.8594,1776,1886.8594,1766,1890.8594,1770,1886.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1772" y1="1886.8594" y2="1886.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1007" y="1881.7935">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="1029" y="1881.7935">Database transaction committed.</text><polygon fill="#181818" points="777,1911.9922,767,1915.9922,777,1919.9922,773,1915.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="771" x2="999" y1="1915.9922" y2="1915.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="783" y="1910.9263">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="805" y="1910.9263">Return result.</text><polygon fill="#181818" points="584,1941.125,574,1945.125,584,1949.125,580,1945.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="578" x2="765" y1="1945.125" y2="1945.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="590" y="1940.0591">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="612" y="1940.0591">Return result.</text><polygon fill="#181818" points="380,1970.2578,370,1974.2578,380,1978.2578,376,1974.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="374" x2="572" y1="1974.2578" y2="1974.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="386" y="1969.1919">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="408" y="1969.1919">Return result.</text><polygon fill="#181818" points="97,1999.3906,87,2003.3906,97,2007.3906,93,2003.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="91" x2="368" y1="2003.3906" y2="2003.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="103" y="1998.3247">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="125" y="1998.3247">Return result.</text><!--MD5=[d258a92e71495ce957342705de9cca06]
@startuml

actor "Mojaloop Adapter" as dfsp
note over dfsp
    * Participant Bank A
    * Participant Bank B
end note

box Central-Ledger #FFFFF9
    participant "**API**" as cl_api
    participant "__api__ / Handler" as cl_handler
    participant "__domain__ / Service" as cl_domain
    participant "__models__ / Facade" as cl_facade

    note over cl_api
        REST API deployed in NodeJS
    end note

    note over cl_handler
        JSON request decoded and
        sent for processing via a handler
    end note

    note over cl_domain
        Domain folder where the service
        functions are exposed.
    end note

    note over cl_facade
        Facade for storing/retrieving data from
        MySQL and TigerBeetle
    end note
end box

box Storage #F9FFF9
	control "TigerBeetle Client" as tb_client
	collections "TigerBeetle Cluster" as tb_nodes
	database "central-ledger" as cl_db
	database "Redis" as redis_cache
end box

autonumber
group Create Transfer (2-Phase)
    dfsp -> cl_api : //JSON// \n**(transfer data)**
    cl_api -> cl_handler : ///jmeter/transfers/prepare// \nHandler invoked
    cl_handler -> cl_domain : Service layer invoked
    cl_domain -> cl_facade : Domain to facade
    cl_facade -> cl_db : Perform the following validations against the database:\n*//validateFspiopSourceMatchesPayer//\n*//validateParticipantByName//\n*//validatePositionAccountByNameAndCurrency//\n*//validateParticipantByName//\n*//validateAmount//\n*//validateConditionAndExpiration//\n*//validateDifferentDfsp//
    cl_facade -> redis_cache : Lookup participant data by \n//name//, //account type// (POSITION) and //currency//.
    autonumber stop
    cl_facade - -> cl_db : If the participant data is not available in Redis, a database lookup is performed
    cl_facade - -> redis_cache : Data looked up is now stored in Redis.
    autonumber resume
    cl_facade -> tb_client : Pending //Transfer// requested via the CL-TB interface.
    tb_client -> tb_nodes : //transfer// Distributed to nodes\n via the state machine.
    tb_nodes -> tb_nodes : Replication via VSR.
    tb_client - -> cl_facade : //transfer// create error **(none)**
    cl_facade - -> cl_domain : Return result
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_api : Return result
    cl_api - -> dfsp : Return result with //**transferId**//
    == Asynchronous Database Activities START ==
    cl_facade -> cl_db : **[ASYNC 1.1]**\n*//transferDuplicateCheck// DB record created.
    cl_facade -> cl_db : **[ASYNC 1.2]**\n*//transfer//, \n*//transferParticipant//, \n*//ilpPacket// \n*//transferStateChange// \n*//transferExtension//\nDatabase records created.
    cl_db <- -> cl_facade : **[ASYNC 1.3]**\n Database transaction committed.
    == Asynchronous Database Activities STOP ==

||70||

    == Transfer Fulfilment ==
    dfsp -> cl_api : //JSON// \n(fulfil transfer data with //**transferId**//)
    cl_api -> cl_handler : ///jmeter/transfers/fulfil// \nHandler invoked.
    cl_handler -> cl_domain : Service layer invoked \n//handlePayeeResponse//
    cl_domain -> cl_facade : Domain to facade \n//savePayeeTransferResponse//
    cl_facade -> cl_db : New Database transaction for fulfillment.
    cl_facade -> cl_db : Obtain //**settlementWindowId**// for window where state is **OPEN**.
    cl_facade -> tb_client : //Transfer// posting requested via the CL-TB interface.
    tb_client -> tb_nodes : //transfer// Distributed to nodes\n via the state machine.
    tb_nodes -> tb_nodes : Replication via VSR.
    tb_client - -> cl_facade : //transfer// posting create error **(none)**.
    cl_facade -> cl_db : Create \n*//transferFulfilment// \n*//transferStateChange// \nDatabase records.
    cl_facade -> cl_db : Database transaction committed.
    cl_facade - -> cl_domain : Return result.
    cl_domain - -> cl_handler : Return result.
    cl_handler - -> cl_api : Return result.
    cl_api - -> dfsp : Return result.
end

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>