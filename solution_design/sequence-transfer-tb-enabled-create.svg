<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2360px" preserveAspectRatio="none" style="width:1895px;height:2360px;background:#FFFFFF;" version="1.1" viewBox="0 0 1895 2360" width="1895px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="2341.9111" style="stroke:#181818;stroke-width:0.5;" width="643.5" x="313" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="584.25" y="19.897">Central-Ledger</text><rect fill="#F9FFF9" height="2341.9111" style="stroke:#181818;stroke-width:0.5;" width="514" x="1358" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1588" y="19.897">Storage</text><rect height="1876.0091" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1868" x="10" y="386.8341"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="87" x2="87" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="336" x2="336" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="520" x2="520" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="690" x2="690" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="890.5" x2="890.5" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1429" x2="1429" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1641.5" x2="1641.5" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1789" x2="1789" y1="92.7739" y2="2279.8432"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1846" x2="1846" y1="92.7739" y2="2279.8432"/><rect fill="#B0D5FF" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="20" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="27" y="80.672">Mojaloop Adapter</text><rect fill="#B0D5FF" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="20" y="2278.8432"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="27" y="2300.8092">Mojaloop Adapter</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="38" x="317" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24" x="324" y="80.672">API</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="38" x="317" y="2278.8432"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24" x="324" y="2300.8092">API</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="469" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="21" x="476" y="80.672">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="501" y="80.672">/ Handler</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="469" y="2278.8432"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="21" x="476" y="2300.8092">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="501" y="2300.8092">/ Handler</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="627" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="51" x="634" y="80.672">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="689" y="80.672">/ Service</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="627" y="2278.8432"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="51" x="634" y="2300.8092">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="689" y="2300.8092">/ Service</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="829.5" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="836.5" y="80.672">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="889.5" y="80.672">/ Facade</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="829.5" y="2278.8432"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="836.5" y="2300.8092">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="889.5" y="2300.8092">/ Facade</text><rect fill="#D5E8D4" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1362" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1369" y="80.672">TigerBeetle Client</text><rect fill="#D5E8D4" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1362" y="2278.8432"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1369" y="2300.8092">TigerBeetle Client</text><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1572.5" y="54.706"/><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1568.5" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1575.5" y="80.672">TigerBeetle Cluster</text><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1572.5" y="2278.8432"/><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1568.5" y="2282.8432"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1575.5" y="2304.8092">TigerBeetle Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1763" y="88.672">MySQL</text><path d="M1771,37.706 C1771,27.706 1789,27.706 1789,27.706 C1789,27.706 1807,27.706 1807,37.706 L1807,63.706 C1807,73.706 1789,73.706 1789,73.706 C1789,73.706 1771,73.706 1771,63.706 L1771,37.706 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1771,37.706 C1771,47.706 1789,47.706 1789,47.706 C1789,47.706 1807,47.706 1807,37.706 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1763" y="2293.8092">MySQL</text><path d="M1771,2307.9111 C1771,2297.9111 1789,2297.9111 1789,2297.9111 C1789,2297.9111 1807,2297.9111 1807,2307.9111 L1807,2333.9111 C1807,2343.9111 1789,2343.9111 1789,2343.9111 C1789,2343.9111 1771,2343.9111 1771,2333.9111 L1771,2307.9111 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1771,2307.9111 C1771,2317.9111 1789,2317.9111 1789,2317.9111 C1789,2317.9111 1807,2317.9111 1807,2307.9111 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1825" y="88.672">Redis</text><path d="M1828.5,37.706 C1828.5,27.706 1846.5,27.706 1846.5,27.706 C1846.5,27.706 1864.5,27.706 1864.5,37.706 L1864.5,63.706 C1864.5,73.706 1846.5,73.706 1846.5,73.706 C1846.5,73.706 1828.5,73.706 1828.5,63.706 L1828.5,37.706 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.5;"/><path d="M1828.5,37.706 C1828.5,47.706 1846.5,47.706 1846.5,47.706 C1846.5,47.706 1864.5,47.706 1864.5,37.706 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1825" y="2293.8092">Redis</text><path d="M1828.5,2307.9111 C1828.5,2297.9111 1846.5,2297.9111 1846.5,2297.9111 C1846.5,2297.9111 1864.5,2297.9111 1864.5,2307.9111 L1864.5,2333.9111 C1864.5,2343.9111 1846.5,2343.9111 1846.5,2343.9111 C1846.5,2343.9111 1828.5,2343.9111 1828.5,2333.9111 L1828.5,2307.9111 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.5;"/><path d="M1828.5,2307.9111 C1828.5,2317.9111 1846.5,2317.9111 1846.5,2317.9111 C1846.5,2317.9111 1864.5,2317.9111 1864.5,2307.9111 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M16,107.7739 L16,152.7739 L158,152.7739 L158,117.7739 L148,107.7739 L16,107.7739 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M148,107.7739 L148,117.7739 L158,117.7739 L148,107.7739 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="27.5" cy="122.9799" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="34" y="126.6709">Participant Bank A</text><ellipse cx="27.5" cy="140.686" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="34" y="144.377">Participant Bank B</text><path d="M275,163.186 L275,208.186 L397,208.186 L397,173.186 L387,163.186 L275,163.186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M387,163.186 L387,173.186 L397,173.186 L387,163.186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="281" y="182.083">NodeJS interface</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="281" y="199.789">invokes REST API</text><path d="M421,218.598 L421,263.598 L619,263.598 L619,228.598 L609,218.598 L421,218.598 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M609,218.598 L609,228.598 L619,228.598 L609,218.598 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="427" y="237.495">JSON request decoded &amp; sent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="427" y="255.201">for processing via a handler</text><path d="M583,274.01 L583,319.01 L796,319.01 L796,284.01 L786,274.01 L583,274.01 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M786,274.01 L786,284.01 L796,284.01 L786,274.01 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="589" y="292.907">Domain folder where the service</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="589" y="310.6131">functions are exposed.</text><path d="M764,329.4221 L764,374.4221 L1018,374.4221 L1018,339.4221 L1008,329.4221 L764,329.4221 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1008,329.4221 L1008,339.4221 L1018,339.4221 L1008,329.4221 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="770" y="348.3191">Facade for storing/retrieving data from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="770" y="366.0251">MySQL and TigerBeetle</text><path d="M10,386.8341 L219,386.8341 L219,396.5401 L209,406.5401 L10,406.5401 L10,386.8341 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1876.0091" style="stroke:#000000;stroke-width:1.5;" width="1868" x="10" y="386.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="25" y="401.7311">Create Transfer (2-Phase)</text><polygon fill="#181818" points="324,443.9521,334,447.9521,324,451.9521,328,447.9521" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="87" x2="330" y1="447.9521" y2="447.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="94" y="433.2901">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="29" x="105" y="424.4371">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="134" y="424.4371"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="95" x="105" y="442.1431">(transfer data)</text><polygon fill="#181818" points="508,493.3642,518,497.3642,508,501.3642,512,497.3642" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="514" y1="497.3642" y2="497.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="343" y="482.7022">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="146" x="354" y="473.8492">/jmeter/transfers/prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="500" y="473.8492"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="354" y="491.5552">Handler invoked</text><polygon fill="#181818" points="678,525.0702,688,529.0702,678,533.0702,682,529.0702" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="520" x2="684" y1="529.0702" y2="529.0702"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="527" y="523.2612">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="538" y="523.2612">Service layer invoked</text><polygon fill="#181818" points="879,556.7762,889,560.7762,879,564.7762,883,560.7762" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="690" x2="885" y1="560.7762" y2="560.7762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="697" y="554.9672">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="708" y="554.9672">Domain to facade</text><polygon fill="#181818" points="1777,712.4243,1787,716.4243,1777,720.4243,1781,716.4243" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1783" y1="716.4243" y2="716.4243"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="898" y="648.6443">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329" x="909" y="586.6732">Perform the following validations against the database:</text><ellipse cx="914.5" cy="600.6882" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="200" x="921" y="604.3792">validateFspiopSourceMatchesPayer</text><ellipse cx="914.5" cy="618.3943" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="153" x="921" y="622.0853">validateParticipantByName</text><ellipse cx="914.5" cy="636.1003" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="257" x="921" y="639.7913">validatePositionAccountByNameAndCurrency</text><ellipse cx="914.5" cy="653.8063" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="153" x="921" y="657.4973">validateParticipantByName</text><ellipse cx="914.5" cy="671.5123" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="89" x="921" y="675.2033">validateAmount</text><ellipse cx="914.5" cy="689.2183" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="181" x="921" y="692.9093">validateConditionAndExpiration</text><ellipse cx="914.5" cy="706.9243" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="120" x="921" y="710.6153">validateDifferentDfsp</text><polygon fill="#181818" points="1834.5,761.8364,1844.5,765.8364,1834.5,769.8364,1838.5,765.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1840.5" y1="765.8364" y2="765.8364"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="898" y="751.1744">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="909" y="742.3214">Lookup participant data by</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="32" x="909" y="760.0274">name</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="941" y="760.0274">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="73" x="947" y="760.0274">account type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="1023" y="760.0274">(POSITION) and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="50" x="1120" y="760.0274">currency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1170" y="760.0274">.</text><polygon fill="#181818" points="1777,793.5424,1787,797.5424,1777,801.5424,1781,797.5424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891" x2="1783" y1="797.5424" y2="797.5424"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="464" x="898" y="791.7334">If the participant data is not available in Redis, a database lookup is performed</text><polygon fill="#181818" points="1834.5,825.2484,1844.5,829.2484,1834.5,833.2484,1838.5,829.2484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891" x2="1840.5" y1="829.2484" y2="829.2484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="898" y="823.4394">Data looked up is now stored in Redis.</text><polygon fill="#181818" points="1417,856.9544,1427,860.9544,1417,864.9544,1421,860.9544" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1423" y1="860.9544" y2="860.9544"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="898" y="855.1454">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="909" y="855.1454">Pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="962" y="855.1454">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="1013" y="855.1454">requested via the CL-TB interface.</text><polygon fill="#181818" points="1630,906.3665,1640,910.3665,1630,914.3665,1634,910.3665" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1429" x2="1636" y1="910.3665" y2="910.3665"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="1436" y="895.7045">8</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="1447" y="886.8514">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1495" y="886.8514">Distributed to nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1450" y="904.5575">via the state machine.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1642" x2="1684" y1="959.7785" y2="959.7785"/><line style="stroke:#181818;stroke-width:1.0;" x1="1684" x2="1684" y1="959.7785" y2="972.7785"/><line style="stroke:#181818;stroke-width:1.0;" x1="1643" x2="1684" y1="972.7785" y2="972.7785"/><polygon fill="#181818" points="1653,968.7785,1643,972.7785,1653,976.7785,1649,972.7785" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="1649" y="945.1165">9</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1660" y="936.2635">[ASYNC]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1660" y="953.9695">Replication via VSR.</text><polygon fill="#181818" points="902,1018.1905,892,1022.1905,902,1026.1905,898,1022.1905" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="896" x2="1428" y1="1022.1905" y2="1022.1905"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="908" y="1007.5285">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="926" y="998.6755">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="974" y="998.6755">create error</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1047" y="998.6755">(none)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="128" x="926" y="1016.3815">(Replicated to 2 nodes)</text><polygon fill="#181818" points="701,1049.8965,691,1053.8965,701,1057.8965,697,1053.8965" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="695" x2="890" y1="1053.8965" y2="1053.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="707" y="1048.0875">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="725" y="1048.0875">Return result</text><polygon fill="#181818" points="531,1081.6026,521,1085.6026,531,1089.6026,527,1085.6026" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="525" x2="689" y1="1085.6026" y2="1085.6026"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="537" y="1079.7936">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="555" y="1079.7936">Return result</text><polygon fill="#181818" points="347,1113.3086,337,1117.3086,347,1121.3086,343,1117.3086" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="519" y1="1117.3086" y2="1117.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="353" y="1111.4996">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="371" y="1111.4996">Return result</text><polygon fill="#181818" points="98,1145.0146,88,1149.0146,98,1153.0146,94,1149.0146" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="92" x2="335" y1="1149.0146" y2="1149.0146"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="104" y="1143.2056">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="122" y="1143.2056">Return result with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="62" x="232" y="1143.2056">transferId</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1888" x="0" y="1178.8676"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1888" y1="1178.8676" y2="1178.8676"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1888" y1="1181.8676" y2="1181.8676"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="281" x="803.5" y="1167.0146"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="264" x="809.5" y="1184.9116">TB and MySQL Database Activities START</text><polygon fill="#181818" points="1777,1222.4266,1787,1226.4266,1777,1230.4266,1781,1226.4266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1783" y1="1226.4266" y2="1226.4266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1220.6176">15</text><ellipse cx="921.5" cy="1216.9266" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="133" x="928" y="1220.6176">transferDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1061" y="1220.6176"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="107" x="1064" y="1220.6176">DB record created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="1171" y="1220.6176">. Built in TB.</text><polygon fill="#181818" points="1777,1342.6627,1787,1346.6627,1777,1350.6627,1781,1346.6627" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1783" y1="1346.6627" y2="1346.6627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1296.5887">16</text><ellipse cx="921.5" cy="1248.6326" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="45" x="928" y="1252.3236">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="3" x="973" y="1252.3236">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="976" y="1252.3236">Built in TB.</text><ellipse cx="921.5" cy="1266.3387" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="107" x="928" y="1270.0297">transferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1038" y="1270.0297">Built in TB.</text><ellipse cx="921.5" cy="1284.0447" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="50" x="928" y="1287.7357">ilpPacket</text><ellipse cx="921.5" cy="1301.7507" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="118" x="928" y="1305.4417">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1046" y="1305.4417">Built in TB.</text><ellipse cx="921.5" cy="1319.4567" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="100" x="928" y="1323.1477">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="916" y="1340.8537">Database records created.</text><polygon fill="#181818" points="902,1374.3687,892,1378.3687,902,1382.3687,898,1378.3687" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1777,1374.3687,1787,1378.3687,1777,1382.3687,1781,1378.3687" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="896" x2="1783" y1="1378.3687" y2="1378.3687"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="908" y="1372.5597">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="926" y="1372.5597">Database transaction committed.</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1888" x="0" y="1408.2218"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1888" y1="1408.2218" y2="1408.2218"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1888" y1="1411.2218" y2="1411.2218"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="273" x="807.5" y="1396.3687"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="256" x="813.5" y="1414.2658">TB and MySQL Database Activities STOP</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1888" x="0" y="1523.9278"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1888" y1="1523.9278" y2="1523.9278"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1888" y1="1526.9278" y2="1526.9278"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="145" x="871.5" y="1512.0748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="877.5" y="1529.9718">Transfer Fulfilment</text><polygon fill="#181818" points="324,1585.1928,334,1589.1928,324,1593.1928,328,1589.1928" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="87" x2="330" y1="1589.1928" y2="1589.1928"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="94" y="1574.5308">18</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="29" x="112" y="1565.6778">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="141" y="1565.6778"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="112" y="1583.3838">(fulfil transfer data with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="62" x="253" y="1583.3838">transferId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="315" y="1583.3838">)</text><polygon fill="#181818" points="508,1634.6048,518,1638.6048,508,1642.6048,512,1638.6048" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="514" y1="1638.6048" y2="1638.6048"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="343" y="1623.9428">19</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="126" x="361" y="1615.0898">/jmeter/transfers/fulfil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="487" y="1615.0898"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="361" y="1632.7958">Handler invoked.</text><polygon fill="#181818" points="678,1684.0169,688,1688.0169,678,1692.0169,682,1688.0169" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="520" x2="684" y1="1688.0169" y2="1688.0169"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="527" y="1673.3549">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="545" y="1664.5019">Service layer invoked</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="126" x="545" y="1682.2079">handlePayeeResponse</text><polygon fill="#181818" points="879,1733.4289,889,1737.4289,879,1741.4289,883,1737.4289" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="690" x2="885" y1="1737.4289" y2="1737.4289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="697" y="1722.7669">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="715" y="1713.9139">Domain to facade</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="159" x="715" y="1731.6199">savePayeeTransferResponse</text><polygon fill="#181818" points="1777,1765.1349,1787,1769.1349,1777,1773.1349,1781,1769.1349" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1783" y1="1769.1349" y2="1769.1349"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1763.3259">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="916" y="1763.3259">New Database transaction for fulfillment.</text><polygon fill="#181818" points="1777,1796.8409,1787,1800.8409,1777,1804.8409,1781,1800.8409" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1783" y1="1800.8409" y2="1800.8409"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1795.0319">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="916" y="1795.0319">Obtain</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="129" x="960" y="1795.0319">settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="1092" y="1795.0319">for window where state is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="36" x="1247" y="1795.0319">OPEN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1283" y="1795.0319">.</text><polygon fill="#181818" points="1417,1846.253,1427,1850.253,1417,1854.253,1421,1850.253" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1423" y1="1850.253" y2="1850.253"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1835.591">24</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="916" y="1826.738">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="967" y="1826.738">posting requested via the CL-TB interface.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="916" y="1844.444">1x -</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="940" y="1844.444">POSITION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1007" y="1844.444">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="1014" y="1844.444">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="1062" y="1844.444">pending posted with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="129" x="1189" y="1844.444">settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="1321" y="1844.444">as</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="1337" y="1844.444">user_data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1409" y="1844.444">.</text><polygon fill="#181818" points="1630,1895.665,1640,1899.665,1630,1903.665,1634,1899.665" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1429" x2="1636" y1="1899.665" y2="1899.665"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1436" y="1885.003">25</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="1454" y="1876.15">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1502" y="1876.15">Distributed to nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1457" y="1893.856">via the state machine.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1642" x2="1684" y1="1949.077" y2="1949.077"/><line style="stroke:#181818;stroke-width:1.0;" x1="1684" x2="1684" y1="1949.077" y2="1962.077"/><line style="stroke:#181818;stroke-width:1.0;" x1="1643" x2="1684" y1="1962.077" y2="1962.077"/><polygon fill="#181818" points="1653,1958.077,1643,1962.077,1653,1966.077,1649,1962.077" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1649" y="1934.415">26</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1667" y="1925.562">[ASYNC]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1667" y="1943.268">Replication via VSR.</text><polygon fill="#181818" points="902,2007.4891,892,2011.4891,902,2015.4891,898,2011.4891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="896" x2="1428" y1="2011.4891" y2="2011.4891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="908" y="1996.8271">27</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="926" y="1987.9741">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="974" y="1987.9741">posting create error</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1096" y="1987.9741">(none)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="128" x="926" y="2005.6801">(Replicated to 2 nodes)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1054" y="2005.6801">.</text><polygon fill="#181818" points="1777,2092.3131,1787,2096.3131,1777,2100.3131,1781,2096.3131" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1783" y1="2096.3131" y2="2096.3131"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="2063.9451">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="916" y="2037.3861">Create</text><ellipse cx="921.5" cy="2051.4011" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="101" x="928" y="2055.0921">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1032" y="2055.0921">Built in TB.</text><ellipse cx="921.5" cy="2069.1071" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="118" x="928" y="2072.7981">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1049" y="2072.7981">Built in TB.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="916" y="2090.5041">Database records.</text><polygon fill="#181818" points="1777,2124.0192,1787,2128.0192,1777,2132.0192,1781,2128.0192" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1783" y1="2128.0192" y2="2128.0192"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="2122.2102">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="916" y="2122.2102">Database transaction committed.</text><polygon fill="#181818" points="701,2155.7252,691,2159.7252,701,2163.7252,697,2159.7252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="695" x2="890" y1="2159.7252" y2="2159.7252"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="707" y="2153.9162">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="725" y="2153.9162">Return result.</text><polygon fill="#181818" points="531,2187.4312,521,2191.4312,531,2195.4312,527,2191.4312" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="525" x2="689" y1="2191.4312" y2="2191.4312"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="537" y="2185.6222">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="555" y="2185.6222">Return result.</text><polygon fill="#181818" points="347,2219.1372,337,2223.1372,347,2227.1372,343,2223.1372" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="519" y1="2223.1372" y2="2223.1372"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="353" y="2217.3282">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="371" y="2217.3282">Return result.</text><polygon fill="#181818" points="98,2250.8432,88,2254.8432,98,2258.8432,94,2254.8432" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="92" x2="335" y1="2254.8432" y2="2254.8432"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="104" y="2249.0342">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="122" y="2249.0342">Return result.</text><!--MD5=[613e49bbdc9d24f97daf74e37fa21cb5]
@startuml

participant "Mojaloop Adapter" as dfsp #B0D5FF
note over dfsp
    * Participant Bank A
    * Participant Bank B
end note

box Central-Ledger #FFFFF9
    participant "**API**" as cl_api
    participant "__api__ / Handler" as cl_handler
    participant "__domain__ / Service" as cl_domain
    participant "__models__ / Facade" as cl_facade

note over cl_api
        NodeJS interface
        invokes REST API
    end note

    note over cl_handler
        JSON request decoded & sent
        for processing via a handler
    end note

    note over cl_domain
        Domain folder where the service
        functions are exposed.
    end note

    note over cl_facade
        Facade for storing/retrieving data from
        MySQL and TigerBeetle
    end note
end box

box Storage #F9FFF9
	participant "TigerBeetle Client" as tb_client #D5E8D4
	collections "TigerBeetle Cluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
	database "Redis" as redis_cache #E1D5E7
end box

autonumber
group Create Transfer (2-Phase)
    dfsp -> cl_api : //JSON// \n**(transfer data)**
    cl_api -> cl_handler : ///jmeter/transfers/prepare// \nHandler invoked
    cl_handler -> cl_domain : Service layer invoked
    cl_domain -> cl_facade : Domain to facade
    cl_facade -> cl_db : Perform the following validations against the database:\n*//validateFspiopSourceMatchesPayer//\n*//validateParticipantByName//\n*//validatePositionAccountByNameAndCurrency//\n*//validateParticipantByName//\n*//validateAmount//\n*//validateConditionAndExpiration//\n*//validateDifferentDfsp//
    cl_facade -> redis_cache : Lookup participant data by \n//name//, //account type// (POSITION) and //currency//.
    autonumber stop
    cl_facade - -> cl_db : If the participant data is not available in Redis, a database lookup is performed
    cl_facade - -> redis_cache : Data looked up is now stored in Redis.
    autonumber resume
    cl_facade -> tb_client : Pending //Transfer// requested via the CL-TB interface.
    tb_client -> tb_nodes : //transfer// Distributed to nodes\n via the state machine.
    tb_nodes -> tb_nodes : **[ASYNC]**\nReplication via VSR.
    tb_client - -> cl_facade : //transfer// create error **(none)**\n//(Replicated to 2 nodes)//
    cl_facade - -> cl_domain : Return result
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_api : Return result
    cl_api - -> dfsp : Return result with //**transferId**//
    == TB and MySQL Database Activities START ==
    cl_facade -> cl_db : *- -//transferDuplicateCheck//- - - -DB record created- -. Built in TB.
    cl_facade -> cl_db : *- -//transfer//,- -Built in TB. \n*- -//transferParticipant//- - Built in TB. \n*//ilpPacket// \n*- -//transferStateChange//- -Built in TB. \n*//transferExtension//\nDatabase records created.
    cl_db <- -> cl_facade : Database transaction committed.
    == TB and MySQL Database Activities STOP ==

||70||

    == Transfer Fulfilment ==
    dfsp -> cl_api : //JSON// \n(fulfil transfer data with //**transferId**//)
    cl_api -> cl_handler : ///jmeter/transfers/fulfil// \nHandler invoked.
    cl_handler -> cl_domain : Service layer invoked \n//handlePayeeResponse//
    cl_domain -> cl_facade : Domain to facade \n//savePayeeTransferResponse//
    cl_facade -> cl_db : New Database transaction for fulfillment.
    cl_facade -> cl_db : Obtain //**settlementWindowId**// for window where state is **OPEN**.
    cl_facade -> tb_client : //Transfer// posting requested via the CL-TB interface.\n1x - ""POSITION"" - //transfer// pending posted with **//settlementWindowId//** as ""user_data"".
    tb_client -> tb_nodes : //transfer// Distributed to nodes\n via the state machine.
    tb_nodes -> tb_nodes : **[ASYNC]**\nReplication via VSR.
    tb_client - -> cl_facade : //transfer// posting create error **(none)**\n//(Replicated to 2 nodes)//.
    cl_facade -> cl_db : Create \n*- -//transferFulfilment//- - Built in TB. \n*- -//transferStateChange//- - Built in TB. \nDatabase records.
    cl_facade -> cl_db : Database transaction committed.
    cl_facade - -> cl_domain : Return result.
    cl_domain - -> cl_handler : Return result.
    cl_handler - -> cl_api : Return result.
    cl_api - -> dfsp : Return result.
end

@enduml

PlantUML version 1.2022.6(Tue Jun 21 19:34:49 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>