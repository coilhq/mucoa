<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1397px" preserveAspectRatio="none" style="width:1141px;height:1397px;background:#FFFFFF;" version="1.1" viewBox="0 0 1141 1397" width="1141px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="1378.0391" style="stroke:#181818;stroke-width:0.5;" width="438.5" x="200" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="95" x="369.75" y="19.4951">Central-Ledger</text><rect fill="#F9FFF9" height="1378.0391" style="stroke:#181818;stroke-width:0.5;" width="403" x="715" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="50" x="889.5" y="19.4951">Storage</text><rect height="982.6563" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1101" x="23" y="317.7734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="68" x2="68" y1="89.9609" y2="1317.4297"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="243" x2="243" y1="89.9609" y2="1317.4297"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="367.5" x2="367.5" y1="89.9609" y2="1317.4297"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="543.5" x2="543.5" y1="89.9609" y2="1317.4297"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="762" x2="762" y1="89.9609" y2="1317.4297"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="954" x2="954" y1="89.9609" y2="1317.4297"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1036" x2="1036" y1="89.9609" y2="1317.4297"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1093" x2="1093" y1="89.9609" y2="1317.4297"/><rect fill="#B0D5FF" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="33" y="39.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="40" y="61.2754">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="43.5" y="78.8848">Adapter</text><rect fill="#B0D5FF" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="33" y="1316.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="40" y="1337.9629">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="43.5" y="1355.5723">Adapter</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="204" y="39.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="225.5" y="61.2754">Kafka</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="211" y="78.8848">Consumer</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="204" y="1316.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="225.5" y="1337.9629">Kafka</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="211" y="1355.5723">Consumer</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="320.5" y="57.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="19" x="327.5" y="78.8848">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="350.5" y="78.8848">/ Handler</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="320.5" y="1316.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="19" x="327.5" y="1337.9629">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="350.5" y="1337.9629">/ Handler</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="452.5" y="39.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="489" y="61.2754">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="459.5" y="78.8848">(domain / service / facade)</text><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="452.5" y="1316.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="489" y="1337.9629">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="459.5" y="1355.5723">(domain / service / facade)</text><rect fill="#D5E8D4" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87" x="719" y="39.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="726" y="61.2754">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="744.5" y="78.8848">Client</text><rect fill="#D5E8D4" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87" x="719" y="1316.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="726" y="1337.9629">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="744.5" y="1355.5723">Client</text><rect fill="#D5E8D4" height="49.2188" style="stroke:#181818;stroke-width:0.5;" width="87" x="913" y="35.7422"/><rect fill="#D5E8D4" height="49.2188" style="stroke:#181818;stroke-width:0.5;" width="87" x="909" y="39.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="916" y="61.2754">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="930" y="78.8848">Cluster</text><rect fill="#D5E8D4" height="49.2188" style="stroke:#181818;stroke-width:0.5;" width="87" x="913" y="1316.4297"/><rect fill="#D5E8D4" height="49.2188" style="stroke:#181818;stroke-width:0.5;" width="87" x="909" y="1320.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="916" y="1341.9629">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="930" y="1359.5723">Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1010" y="86.8848">MySQL</text><path d="M1018,36.3516 C1018,26.3516 1036,26.3516 1036,26.3516 C1036,26.3516 1054,26.3516 1054,36.3516 L1054,62.3516 C1054,72.3516 1036,72.3516 1036,72.3516 C1036,72.3516 1018,72.3516 1018,62.3516 L1018,36.3516 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1018,36.3516 C1018,46.3516 1036,46.3516 1036,46.3516 C1036,46.3516 1054,46.3516 1054,36.3516 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1010" y="1330.9629">MySQL</text><path d="M1018,1344.0391 C1018,1334.0391 1036,1334.0391 1036,1334.0391 C1036,1334.0391 1054,1334.0391 1054,1344.0391 L1054,1370.0391 C1054,1380.0391 1036,1380.0391 1036,1380.0391 C1036,1380.0391 1018,1380.0391 1018,1370.0391 L1018,1344.0391 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1018,1344.0391 C1018,1354.0391 1036,1354.0391 1036,1354.0391 C1036,1354.0391 1054,1354.0391 1054,1344.0391 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1072" y="86.8848">Redis</text><path d="M1075,36.3516 C1075,26.3516 1093,26.3516 1093,26.3516 C1093,26.3516 1111,26.3516 1111,36.3516 L1111,62.3516 C1111,72.3516 1093,72.3516 1093,72.3516 C1093,72.3516 1075,72.3516 1075,62.3516 L1075,36.3516 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.5;"/><path d="M1075,36.3516 C1075,46.3516 1093,46.3516 1093,46.3516 C1093,46.3516 1111,46.3516 1111,36.3516 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="1072" y="1330.9629">Redis</text><path d="M1075,1344.0391 C1075,1334.0391 1093,1334.0391 1093,1334.0391 C1093,1334.0391 1111,1334.0391 1111,1344.0391 L1111,1370.0391 C1111,1380.0391 1093,1380.0391 1093,1380.0391 C1093,1380.0391 1075,1380.0391 1075,1370.0391 L1075,1344.0391 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.5;"/><path d="M1075,1344.0391 C1075,1354.0391 1093,1354.0391 1093,1354.0391 C1093,1354.0391 1111,1354.0391 1111,1344.0391 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M5,104.9609 L5,146.9609 L132,146.9609 L132,114.9609 L122,104.9609 L5,104.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M122,104.9609 L122,114.9609 L132,114.9609 L122,104.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="11" y="123.4561">Participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="11" y="139.8076">DFSP interactions</text><path d="M159,157.6641 L159,199.6641 L328,199.6641 L328,167.6641 L318,157.6641 L159,157.6641 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M318,157.6641 L318,167.6641 L328,167.6641 L318,157.6641 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="165" y="176.1592">Consume JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="165" y="192.5107">requests from Kafka topic</text><path d="M283,210.3672 L283,252.3672 L451,252.3672 L451,220.3672 L441,210.3672 L283,210.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M441,210.3672 L441,220.3672 L451,220.3672 L441,210.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="289" y="228.8623">JSON request decoded &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="289" y="245.2139">processed via handler</text><path d="M450,263.0703 L450,305.0703 L637,305.0703 L637,273.0703 L627,263.0703 L450,263.0703 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M627,263.0703 L627,273.0703 L637,273.0703 L627,263.0703 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="456" y="281.5654">Expose service functions &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="456" y="297.917">handle database interactions</text><path d="M23,317.7734 L228,317.7734 L228,326.125 L218,336.125 L23,336.125 L23,317.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="982.6563" style="stroke:#000000;stroke-width:1.5;" width="1101" x="23" y="317.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160" x="38" y="332.2686">Create Transfer (2-Phase)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1134" x="0" y="357.3008"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1134" y1="357.3008" y2="357.3008"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1134" y1="360.3008" y2="360.3008"/><rect fill="#EEEEEE" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="125" x="504.5" y="346.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="510.5" y="363.6201">Prepare Transfer</text><polygon fill="#181818" points="231.5,415.1797,241.5,419.1797,231.5,423.1797,235.5,419.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="68.5" x2="237.5" y1="419.1797" y2="419.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="75.5" y="406.1475">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="35" x="86.5" y="397.9717">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="121.5" y="397.9717"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="86.5" y="414.3232">(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="48" x="90.5" y="414.3232">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="142.5" y="414.3232">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="43" x="150.5" y="414.3232">prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="197.5" y="414.3232">data)</text><polygon fill="#181818" points="355.5,445.5313,365.5,449.5313,355.5,453.5313,359.5,449.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="243.5" x2="361.5" y1="449.5313" y2="449.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="250.5" y="444.6748">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="261.5" y="444.6748">Invoke handler</text><polygon fill="#181818" points="531.5,475.8828,541.5,479.8828,531.5,483.8828,535.5,479.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367.5" x2="537.5" y1="479.8828" y2="479.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="374.5" y="475.0264">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="385.5" y="475.0264">Invoke application layer</text><polygon fill="#181818" points="1024,506.2344,1034,510.2344,1024,514.2344,1028,510.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="543.5" x2="1030" y1="510.2344" y2="510.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="550.5" y="505.3779">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="561.5" y="505.3779">Validate pending transfer data elements</text><polygon fill="#181818" points="554.5,536.5859,544.5,540.5859,554.5,544.5859,550.5,540.5859" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1081,536.5859,1091,540.5859,1081,544.5859,1085,540.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="548.5" x2="1087" y1="540.5859" y2="540.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="560.5" y="535.7295">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="571.5" y="535.7295">Lookup Participant data from cache</text><polygon fill="#181818" points="554.5,583.2891,544.5,587.2891,554.5,591.2891,550.5,587.2891" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1024,583.2891,1034,587.2891,1024,591.2891,1028,587.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="548.5" x2="1030" y1="587.2891" y2="587.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="560.5" y="566.0811">If Participant data not cached,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="560.5" y="582.4326">then retrieve from SQL database</text><polygon fill="#181818" points="1081,629.9922,1091,633.9922,1081,637.9922,1085,633.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="543.5" x2="1087" y1="633.9922" y2="633.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="550.5" y="612.7842">If not previously cached,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="550.5" y="629.1357">then cache Participant data</text><polygon fill="#181818" points="750.5,660.3438,760.5,664.3438,750.5,668.3438,754.5,664.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="543.5" x2="756.5" y1="664.3438" y2="664.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="550.5" y="659.4873">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="561.5" y="659.4873">Request pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="662.5" y="659.4873">transfer</text><polygon fill="#181818" points="773.5,707.0469,763.5,711.0469,773.5,715.0469,769.5,711.0469" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="942.5,707.0469,952.5,711.0469,942.5,715.0469,946.5,711.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="767.5" x2="948.5" y1="711.0469" y2="711.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="779.5" y="698.0146">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="790.5" y="689.8389">Check duplicates &amp; create</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="790.5" y="706.1904">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="838.5" y="706.1904">prepare account</text><polygon fill="#181818" points="554.5,737.3984,544.5,741.3984,554.5,745.3984,550.5,741.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="548.5" x2="761.5" y1="741.3984" y2="741.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="560.5" y="736.542">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="571.5" y="736.542">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="613.5" y="736.542">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="661.5" y="736.542">create result</text><polygon fill="#181818" points="554.5,784.1016,544.5,788.1016,554.5,792.1016,550.5,788.1016" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1024,784.1016,1034,788.1016,1024,792.1016,1028,788.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="548.5" x2="1030" y1="788.1016" y2="788.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="560.5" y="775.0693">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="571.5" y="766.8936">Create</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="613.5" y="766.8936">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="661.5" y="766.8936">prepare &amp; return result</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="571.5" y="783.2451">(store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="55" x="608.5" y="783.2451">ilpPacket</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="667.5" y="783.2451">&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="101" x="680.5" y="783.2451">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="785.5" y="783.2451">data only)</text><polygon fill="#181818" points="378.5,814.4531,368.5,818.4531,378.5,822.4531,374.5,818.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="372.5" x2="542.5" y1="818.4531" y2="818.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="384.5" y="813.5967">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="402.5" y="813.5967">Return result</text><polygon fill="#181818" points="254.5,844.8047,244.5,848.8047,254.5,852.8047,250.5,848.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="248.5" x2="366.5" y1="848.8047" y2="848.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="260.5" y="843.9482">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="278.5" y="843.9482">Return result</text><polygon fill="#181818" points="79.5,875.1563,69.5,879.1563,79.5,883.1563,75.5,879.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="73.5" x2="242.5" y1="879.1563" y2="879.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="85.5" y="874.2998">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="103.5" y="874.2998">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="57" x="145.5" y="874.2998">transferId</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1134" x="0" y="908.332"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1134" y1="908.332" y2="908.332"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1134" y1="911.332" y2="911.332"/><rect fill="#EEEEEE" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="106" x="514" y="897.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="88" x="520" y="914.6514">Fulfil Transfer</text><polygon fill="#181818" points="231.5,966.2109,241.5,970.2109,231.5,974.2109,235.5,970.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="68.5" x2="237.5" y1="970.2109" y2="970.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="75.5" y="957.1787">13</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="35" x="93.5" y="949.0029">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="128.5" y="949.0029"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="93.5" y="965.3545">(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="48" x="97.5" y="965.3545">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="149.5" y="965.3545">- fulfil data)</text><polygon fill="#181818" points="355.5,996.5625,365.5,1000.5625,355.5,1004.5625,359.5,1000.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="243.5" x2="361.5" y1="1000.5625" y2="1000.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="250.5" y="995.7061">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="268.5" y="995.7061">Invoke handler</text><polygon fill="#181818" points="531.5,1026.9141,541.5,1030.9141,531.5,1034.9141,535.5,1030.9141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367.5" x2="537.5" y1="1030.9141" y2="1030.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="374.5" y="1026.0576">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="392.5" y="1026.0576">Invoke application layer</text><polygon fill="#181818" points="554.5,1073.6172,544.5,1077.6172,554.5,1081.6172,550.5,1077.6172" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1024,1073.6172,1034,1077.6172,1024,1081.6172,1028,1077.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="548.5" x2="1030" y1="1077.6172" y2="1077.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="560.5" y="1064.585">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="578.5" y="1056.4092">Create</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="620.5" y="1056.4092">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="668.5" y="1056.4092">fulfillment &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="578.5" y="1072.7607">obtain open settlement window</text><polygon fill="#181818" points="750.5,1103.9688,760.5,1107.9688,750.5,1111.9688,754.5,1107.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="543.5" x2="756.5" y1="1107.9688" y2="1107.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="550.5" y="1103.1123">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="568.5" y="1103.1123">Post the pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="670.5" y="1103.1123">transfer</text><polygon fill="#181818" points="942.5,1150.6719,952.5,1154.6719,942.5,1158.6719,946.5,1154.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="762.5" x2="948.5" y1="1154.6719" y2="1154.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="769.5" y="1141.6396">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="787.5" y="1133.4639">Fulfil pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="867.5" y="1133.4639">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="911.5" y="1133.4639"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="787.5" y="1149.8154">(update status to posted)</text><polygon fill="#181818" points="554.5,1181.0234,544.5,1185.0234,554.5,1189.0234,550.5,1185.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="548.5" x2="761.5" y1="1185.0234" y2="1185.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="560.5" y="1180.167">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="578.5" y="1180.167">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="44" x="620.5" y="1180.167">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="668.5" y="1180.167">fulfilment result</text><polygon fill="#181818" points="378.5,1211.375,368.5,1215.375,378.5,1219.375,374.5,1215.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="372.5" x2="542.5" y1="1215.375" y2="1215.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="384.5" y="1210.5186">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="402.5" y="1210.5186">Return result</text><polygon fill="#181818" points="254.5,1241.7266,244.5,1245.7266,254.5,1249.7266,250.5,1245.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="248.5" x2="366.5" y1="1245.7266" y2="1245.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="260.5" y="1240.8701">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="278.5" y="1240.8701">Return result</text><polygon fill="#181818" points="79.5,1288.4297,69.5,1292.4297,79.5,1296.4297,75.5,1292.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="73.5" x2="242.5" y1="1292.4297" y2="1292.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="85.5" y="1279.3975">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="103.5" y="1271.2217">Return transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="103.5" y="1287.5732">fulfilment result</text><!--MD5=[5b0267e932cc3ffb46df4cce5149809c]
@startuml

participant "Mojaloop\nAdapter" as dfsp #B0D5FF
note over dfsp
    Participant
    DFSP interactions
end note

box Central-Ledger #FFFFF9
    participant "Kafka\nConsumer" as cl_consume_kafka
    participant "__api__ / Handler" as cl_handler
    participant "Application Layer\n(domain / service / facade)" as cl_domain

        note over cl_consume_kafka
            Consume JSON
            requests from Kafka topic
        end note

        note over cl_handler
            JSON request decoded &
            processed via handler
        end note

        note over cl_domain
            Expose service functions &
            handle database interactions
        end note
end box

box Storage #F9FFF9
	participant "TigerBeetle\nClient" as tb_client #D5E8D4
	collections "TigerBeetle\nCluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
	database "Redis" as redis_cache #E1D5E7
end box

autonumber
group Create Transfer (2-Phase)
    == Prepare Transfer ==
    dfsp -> cl_consume_kafka : //JSON// \n(**transfer** - //prepare// data)
    cl_consume_kafka -> cl_handler : Invoke handler
    cl_handler -> cl_domain : Invoke application layer
    cl_domain -> cl_db : Validate pending transfer data elements
    cl_domain <- -> redis_cache : Lookup Participant data from cache
    autonumber stop

    cl_domain <- -> cl_db : If Participant data not cached, \nthen retrieve from SQL database
    cl_domain -> redis_cache : If not previously cached, \nthen cache Participant data

    autonumber resume

    cl_domain -> tb_client : Request pending //transfer//
    tb_client <- -> tb_nodes : Check duplicates & create \n//transfer// prepare account
    tb_client - -> cl_domain : Return //transfer// create result
    cl_domain <- -> cl_db : Create //transfer// prepare & return result \n(store //ilpPacket// & //transferExtension// data only)
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_consume_kafka : Return result
    cl_consume_kafka - -> dfsp : Return //**transferId**//

    == Fulfil Transfer ==
    dfsp -> cl_consume_kafka : //JSON// \n(**transfer** - fulfil data)
    cl_consume_kafka -> cl_handler : Invoke handler
    cl_handler -> cl_domain : Invoke application layer
    cl_domain <- -> cl_db : Create //transfer// fulfillment & \nobtain open settlement window
    cl_domain -> tb_client : Post the pending //transfer//
    tb_client -> tb_nodes : Fulfil pending //transfer// \n(update status to posted)
    tb_client - -> cl_domain : Return //transfer// fulfilment result
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_consume_kafka : Return result
    cl_consume_kafka - -> dfsp : Return transfer \nfulfilment result
end

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CAT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>