<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2343px" preserveAspectRatio="none" style="width:1698px;height:2343px;background:#FFFFFF;" version="1.1" viewBox="0 0 1698 2343" width="1698px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="2324.2051" style="stroke:#181818;stroke-width:0.5;" width="643.5" x="313" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="584.25" y="19.897">Central-Ledger</text><rect fill="#F9FFF9" height="2324.2051" style="stroke:#181818;stroke-width:0.5;" width="514" x="1161" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1391" y="19.897">Storage</text><rect height="1858.3031" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1671" x="10" y="386.8341"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="87" x2="87" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="336" x2="336" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="520" x2="520" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="690" x2="690" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="890.5" x2="890.5" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1232" x2="1232" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1444.5" x2="1444.5" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1592" x2="1592" y1="92.7739" y2="2262.1372"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1649" x2="1649" y1="92.7739" y2="2262.1372"/><rect fill="#B0D5FF" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="20" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="27" y="80.672">Mojaloop Adapter</text><rect fill="#B0D5FF" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="20" y="2261.1372"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="27" y="2283.1031">Mojaloop Adapter</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="38" x="317" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24" x="324" y="80.672">API</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="38" x="317" y="2261.1372"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="24" x="324" y="2283.1031">API</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="469" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="21" x="476" y="80.672">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="501" y="80.672">/ Handler</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="469" y="2261.1372"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="21" x="476" y="2283.1031">api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="501" y="2283.1031">/ Handler</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="627" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="51" x="634" y="80.672">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="689" y="80.672">/ Service</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="627" y="2261.1372"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="51" x="634" y="2283.1031">domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="689" y="2283.1031">/ Service</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="829.5" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="836.5" y="80.672">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="889.5" y="80.672">/ Facade</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="829.5" y="2261.1372"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="836.5" y="2283.1031">models</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="889.5" y="2283.1031">/ Facade</text><rect fill="#D5E8D4" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1165" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1172" y="80.672">TigerBeetle Client</text><rect fill="#D5E8D4" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1165" y="2261.1372"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1172" y="2283.1031">TigerBeetle Client</text><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1375.5" y="54.706"/><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1371.5" y="58.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1378.5" y="80.672">TigerBeetle Cluster</text><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1375.5" y="2261.1372"/><rect fill="#D5E8D4" height="33.0679" style="stroke:#181818;stroke-width:0.5;" width="143" x="1371.5" y="2265.1372"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1378.5" y="2287.1031">TigerBeetle Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1566" y="88.672">MySQL</text><path d="M1574,37.706 C1574,27.706 1592,27.706 1592,27.706 C1592,27.706 1610,27.706 1610,37.706 L1610,63.706 C1610,73.706 1592,73.706 1592,73.706 C1592,73.706 1574,73.706 1574,63.706 L1574,37.706 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1574,37.706 C1574,47.706 1592,47.706 1592,47.706 C1592,47.706 1610,47.706 1610,37.706 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1566" y="2276.1031">MySQL</text><path d="M1574,2290.2051 C1574,2280.2051 1592,2280.2051 1592,2280.2051 C1592,2280.2051 1610,2280.2051 1610,2290.2051 L1610,2316.2051 C1610,2326.2051 1592,2326.2051 1592,2326.2051 C1592,2326.2051 1574,2326.2051 1574,2316.2051 L1574,2290.2051 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.5;"/><path d="M1574,2290.2051 C1574,2300.2051 1592,2300.2051 1592,2300.2051 C1592,2300.2051 1610,2300.2051 1610,2290.2051 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1628" y="88.672">Redis</text><path d="M1631.5,37.706 C1631.5,27.706 1649.5,27.706 1649.5,27.706 C1649.5,27.706 1667.5,27.706 1667.5,37.706 L1667.5,63.706 C1667.5,73.706 1649.5,73.706 1649.5,73.706 C1649.5,73.706 1631.5,73.706 1631.5,63.706 L1631.5,37.706 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.5;"/><path d="M1631.5,37.706 C1631.5,47.706 1649.5,47.706 1649.5,47.706 C1649.5,47.706 1667.5,47.706 1667.5,37.706 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="1628" y="2276.1031">Redis</text><path d="M1631.5,2290.2051 C1631.5,2280.2051 1649.5,2280.2051 1649.5,2280.2051 C1649.5,2280.2051 1667.5,2280.2051 1667.5,2290.2051 L1667.5,2316.2051 C1667.5,2326.2051 1649.5,2326.2051 1649.5,2326.2051 C1649.5,2326.2051 1631.5,2326.2051 1631.5,2316.2051 L1631.5,2290.2051 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.5;"/><path d="M1631.5,2290.2051 C1631.5,2300.2051 1649.5,2300.2051 1649.5,2300.2051 C1649.5,2300.2051 1667.5,2300.2051 1667.5,2290.2051 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><path d="M16,107.7739 L16,152.7739 L158,152.7739 L158,117.7739 L148,107.7739 L16,107.7739 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M148,107.7739 L148,117.7739 L158,117.7739 L148,107.7739 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="27.5" cy="122.9799" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="34" y="126.6709">Participant Bank A</text><ellipse cx="27.5" cy="140.686" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="34" y="144.377">Participant Bank B</text><path d="M275,163.186 L275,208.186 L397,208.186 L397,173.186 L387,163.186 L275,163.186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M387,163.186 L387,173.186 L397,173.186 L387,163.186 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="281" y="182.083">NodeJS interface</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="281" y="199.789">invokes REST API</text><path d="M421,218.598 L421,263.598 L619,263.598 L619,228.598 L609,218.598 L421,218.598 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M609,218.598 L609,228.598 L619,228.598 L609,218.598 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="427" y="237.495">JSON request decoded &amp; sent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="427" y="255.201">for processing via a handler</text><path d="M583,274.01 L583,319.01 L796,319.01 L796,284.01 L786,274.01 L583,274.01 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M786,274.01 L786,284.01 L796,284.01 L786,274.01 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="589" y="292.907">Domain folder where the service</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="589" y="310.6131">functions are exposed.</text><path d="M764,329.4221 L764,374.4221 L1018,374.4221 L1018,339.4221 L1008,329.4221 L764,329.4221 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1008,329.4221 L1008,339.4221 L1018,339.4221 L1008,329.4221 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="770" y="348.3191">Facade for storing/retrieving data from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="770" y="366.0251">MySQL and TigerBeetle</text><path d="M10,386.8341 L219,386.8341 L219,396.5401 L209,406.5401 L10,406.5401 L10,386.8341 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1858.3031" style="stroke:#000000;stroke-width:1.5;" width="1671" x="10" y="386.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="25" y="401.7311">Create Transfer (2-Phase)</text><polygon fill="#181818" points="324,443.9521,334,447.9521,324,451.9521,328,447.9521" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="87" x2="330" y1="447.9521" y2="447.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="94" y="433.2901">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="29" x="105" y="424.4371">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="134" y="424.4371"> </text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="95" x="105" y="442.1431">(transfer data)</text><polygon fill="#181818" points="508,493.3642,518,497.3642,508,501.3642,512,497.3642" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="514" y1="497.3642" y2="497.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="343" y="482.7022">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="146" x="354" y="473.8492">/jmeter/transfers/prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="500" y="473.8492"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="354" y="491.5552">Handler invoked</text><polygon fill="#181818" points="678,525.0702,688,529.0702,678,533.0702,682,529.0702" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="520" x2="684" y1="529.0702" y2="529.0702"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="527" y="523.2612">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="538" y="523.2612">Service layer invoked</text><polygon fill="#181818" points="879,556.7762,889,560.7762,879,564.7762,883,560.7762" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="690" x2="885" y1="560.7762" y2="560.7762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="697" y="554.9672">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="708" y="554.9672">Domain to facade</text><polygon fill="#181818" points="1580,712.4243,1590,716.4243,1580,720.4243,1584,716.4243" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1586" y1="716.4243" y2="716.4243"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="898" y="648.6443">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329" x="909" y="586.6732">Perform the following validations against the database:</text><ellipse cx="914.5" cy="600.6882" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="200" x="921" y="604.3792">validateFspiopSourceMatchesPayer</text><ellipse cx="914.5" cy="618.3943" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="153" x="921" y="622.0853">validateParticipantByName</text><ellipse cx="914.5" cy="636.1003" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="257" x="921" y="639.7913">validatePositionAccountByNameAndCurrency</text><ellipse cx="914.5" cy="653.8063" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="153" x="921" y="657.4973">validateParticipantByName</text><ellipse cx="914.5" cy="671.5123" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="89" x="921" y="675.2033">validateAmount</text><ellipse cx="914.5" cy="689.2183" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="181" x="921" y="692.9093">validateConditionAndExpiration</text><ellipse cx="914.5" cy="706.9243" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="120" x="921" y="710.6153">validateDifferentDfsp</text><polygon fill="#181818" points="1637.5,761.8364,1647.5,765.8364,1637.5,769.8364,1641.5,765.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1643.5" y1="765.8364" y2="765.8364"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="898" y="751.1744">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="909" y="742.3214">Lookup participant data by</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="32" x="909" y="760.0274">name</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="941" y="760.0274">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="73" x="947" y="760.0274">account type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="1023" y="760.0274">(POSITION) and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="50" x="1120" y="760.0274">currency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1170" y="760.0274">.</text><polygon fill="#181818" points="1580,793.5424,1590,797.5424,1580,801.5424,1584,797.5424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891" x2="1586" y1="797.5424" y2="797.5424"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="464" x="898" y="791.7334">If the participant data is not available in Redis, a database lookup is performed</text><polygon fill="#181818" points="1637.5,825.2484,1647.5,829.2484,1637.5,833.2484,1641.5,829.2484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891" x2="1643.5" y1="829.2484" y2="829.2484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="898" y="823.4394">Data looked up is now stored in Redis.</text><polygon fill="#181818" points="1220,856.9544,1230,860.9544,1220,864.9544,1224,860.9544" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1226" y1="860.9544" y2="860.9544"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="898" y="855.1454">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="909" y="855.1454">Pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="962" y="855.1454">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="1013" y="855.1454">requested via the CL-TB interface.</text><polygon fill="#181818" points="1433,906.3665,1443,910.3665,1433,914.3665,1437,910.3665" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1232" x2="1439" y1="910.3665" y2="910.3665"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="1239" y="895.7045">8</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="1250" y="886.8514">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1298" y="886.8514">Distributed to nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1253" y="904.5575">via the state machine.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1445" x2="1487" y1="959.7785" y2="959.7785"/><line style="stroke:#181818;stroke-width:1.0;" x1="1487" x2="1487" y1="959.7785" y2="972.7785"/><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="1487" y1="972.7785" y2="972.7785"/><polygon fill="#181818" points="1456,968.7785,1446,972.7785,1456,976.7785,1452,972.7785" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="1452" y="945.1165">9</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1463" y="936.2635">[ASYNC]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1463" y="953.9695">Replication via VSR.</text><polygon fill="#181818" points="902,1018.1905,892,1022.1905,902,1026.1905,898,1022.1905" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="896" x2="1231" y1="1022.1905" y2="1022.1905"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="908" y="1007.5285">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="926" y="998.6755">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="974" y="998.6755">create error</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1047" y="998.6755">(none)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="128" x="926" y="1016.3815">(Replicated to 2 nodes)</text><polygon fill="#181818" points="701,1049.8965,691,1053.8965,701,1057.8965,697,1053.8965" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="695" x2="890" y1="1053.8965" y2="1053.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="707" y="1048.0875">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="725" y="1048.0875">Return result</text><polygon fill="#181818" points="531,1081.6026,521,1085.6026,531,1089.6026,527,1085.6026" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="525" x2="689" y1="1085.6026" y2="1085.6026"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="537" y="1079.7936">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="555" y="1079.7936">Return result</text><polygon fill="#181818" points="347,1113.3086,337,1117.3086,347,1121.3086,343,1117.3086" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="519" y1="1117.3086" y2="1117.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="353" y="1111.4996">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="371" y="1111.4996">Return result</text><polygon fill="#181818" points="98,1145.0146,88,1149.0146,98,1153.0146,94,1149.0146" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="92" x2="335" y1="1149.0146" y2="1149.0146"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="104" y="1143.2056">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="122" y="1143.2056">Return result with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="62" x="232" y="1143.2056">transferId</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1691" x="0" y="1178.8676"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1691" y1="1178.8676" y2="1178.8676"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1691" y1="1181.8676" y2="1181.8676"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="281" x="705" y="1167.0146"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="264" x="711" y="1184.9116">TB and MySQL Database Activities START</text><polygon fill="#181818" points="1580,1222.4266,1590,1226.4266,1580,1230.4266,1584,1226.4266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1586" y1="1226.4266" y2="1226.4266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1220.6176">15</text><ellipse cx="921.5" cy="1216.9266" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="133" x="928" y="1220.6176">transferDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1061" y="1220.6176"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="107" x="1064" y="1220.6176">DB record created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="1171" y="1220.6176">. Built in TB.</text><polygon fill="#181818" points="1580,1342.6627,1590,1346.6627,1580,1350.6627,1584,1346.6627" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1586" y1="1346.6627" y2="1346.6627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1296.5887">16</text><ellipse cx="921.5" cy="1248.6326" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="45" x="928" y="1252.3236">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="3" x="973" y="1252.3236">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="976" y="1252.3236">Built in TB.</text><ellipse cx="921.5" cy="1266.3387" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="107" x="928" y="1270.0297">transferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1038" y="1270.0297">Built in TB.</text><ellipse cx="921.5" cy="1284.0447" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="50" x="928" y="1287.7357">ilpPacket</text><ellipse cx="921.5" cy="1301.7507" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="118" x="928" y="1305.4417">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1046" y="1305.4417">Built in TB.</text><ellipse cx="921.5" cy="1319.4567" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="100" x="928" y="1323.1477">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="916" y="1340.8537">Database records created.</text><polygon fill="#181818" points="902,1374.3687,892,1378.3687,902,1382.3687,898,1378.3687" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1580,1374.3687,1590,1378.3687,1580,1382.3687,1584,1378.3687" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="896" x2="1586" y1="1378.3687" y2="1378.3687"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="908" y="1372.5597">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="926" y="1372.5597">Database transaction committed.</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1691" x="0" y="1408.2218"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1691" y1="1408.2218" y2="1408.2218"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1691" y1="1411.2218" y2="1411.2218"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="273" x="709" y="1396.3687"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="256" x="715" y="1414.2658">TB and MySQL Database Activities STOP</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1691" x="0" y="1523.9278"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1691" y1="1523.9278" y2="1523.9278"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1691" y1="1526.9278" y2="1526.9278"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="145" x="773" y="1512.0748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="779" y="1529.9718">Transfer Fulfilment</text><polygon fill="#181818" points="324,1585.1928,334,1589.1928,324,1593.1928,328,1589.1928" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="87" x2="330" y1="1589.1928" y2="1589.1928"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="94" y="1574.5308">18</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="29" x="112" y="1565.6778">JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="141" y="1565.6778"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="112" y="1583.3838">(fulfil transfer data with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="62" x="253" y="1583.3838">transferId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="315" y="1583.3838">)</text><polygon fill="#181818" points="508,1634.6048,518,1638.6048,508,1642.6048,512,1638.6048" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="514" y1="1638.6048" y2="1638.6048"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="343" y="1623.9428">19</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="126" x="361" y="1615.0898">/jmeter/transfers/fulfil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="487" y="1615.0898"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="361" y="1632.7958">Handler invoked.</text><polygon fill="#181818" points="678,1684.0169,688,1688.0169,678,1692.0169,682,1688.0169" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="520" x2="684" y1="1688.0169" y2="1688.0169"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="527" y="1673.3549">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="545" y="1664.5019">Service layer invoked</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="126" x="545" y="1682.2079">handlePayeeResponse</text><polygon fill="#181818" points="879,1733.4289,889,1737.4289,879,1741.4289,883,1737.4289" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="690" x2="885" y1="1737.4289" y2="1737.4289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="697" y="1722.7669">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="715" y="1713.9139">Domain to facade</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="159" x="715" y="1731.6199">savePayeeTransferResponse</text><polygon fill="#181818" points="1580,1765.1349,1590,1769.1349,1580,1773.1349,1584,1769.1349" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1586" y1="1769.1349" y2="1769.1349"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1763.3259">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="916" y="1763.3259">New Database transaction for fulfillment.</text><polygon fill="#181818" points="1580,1796.8409,1590,1800.8409,1580,1804.8409,1584,1800.8409" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1586" y1="1800.8409" y2="1800.8409"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1795.0319">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="916" y="1795.0319">Obtain</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="129" x="960" y="1795.0319">settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="1092" y="1795.0319">for window where state is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="36" x="1247" y="1795.0319">OPEN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1283" y="1795.0319">.</text><polygon fill="#181818" points="1220,1828.547,1230,1832.547,1220,1836.547,1224,1832.547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1226" y1="1832.547" y2="1832.547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="1826.738">24</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="916" y="1826.738">Transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="967" y="1826.738">posting requested via the CL-TB interface.</text><polygon fill="#181818" points="1433,1877.959,1443,1881.959,1433,1885.959,1437,1881.959" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1232" x2="1439" y1="1881.959" y2="1881.959"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1239" y="1867.297">25</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="1257" y="1858.444">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1305" y="1858.444">Distributed to nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1260" y="1876.15">via the state machine.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1445" x2="1487" y1="1931.371" y2="1931.371"/><line style="stroke:#181818;stroke-width:1.0;" x1="1487" x2="1487" y1="1931.371" y2="1944.371"/><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="1487" y1="1944.371" y2="1944.371"/><polygon fill="#181818" points="1456,1940.371,1446,1944.371,1456,1948.371,1452,1944.371" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1452" y="1916.709">26</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1470" y="1907.856">[ASYNC]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1470" y="1925.562">Replication via VSR.</text><polygon fill="#181818" points="902,1989.7831,892,1993.7831,902,1997.7831,898,1993.7831" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="896" x2="1231" y1="1993.7831" y2="1993.7831"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="908" y="1979.121">27</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="926" y="1970.268">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="974" y="1970.268">posting create error</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1096" y="1970.268">(none)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="128" x="926" y="1987.9741">(Replicated to 2 nodes)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="1054" y="1987.9741">.</text><polygon fill="#181818" points="1580,2074.6071,1590,2078.6071,1580,2082.6071,1584,2078.6071" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1586" y1="2078.6071" y2="2078.6071"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="2046.2391">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="916" y="2019.6801">Create</text><ellipse cx="921.5" cy="2033.6951" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="101" x="928" y="2037.3861">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1032" y="2037.3861">Built in TB.</text><ellipse cx="921.5" cy="2051.4011" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" text-decoration="line-through" textLength="118" x="928" y="2055.0921">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="1049" y="2055.0921">Built in TB.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="916" y="2072.7981">Database records.</text><polygon fill="#181818" points="1580,2106.3131,1590,2110.3131,1580,2114.3131,1584,2110.3131" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="891" x2="1586" y1="2110.3131" y2="2110.3131"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="898" y="2104.5041">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="916" y="2104.5041">Database transaction committed.</text><polygon fill="#181818" points="701,2138.0192,691,2142.0192,701,2146.0192,697,2142.0192" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="695" x2="890" y1="2142.0192" y2="2142.0192"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="707" y="2136.2102">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="725" y="2136.2102">Return result.</text><polygon fill="#181818" points="531,2169.7252,521,2173.7252,531,2177.7252,527,2173.7252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="525" x2="689" y1="2173.7252" y2="2173.7252"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="537" y="2167.9162">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="555" y="2167.9162">Return result.</text><polygon fill="#181818" points="347,2201.4312,337,2205.4312,347,2209.4312,343,2205.4312" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="519" y1="2205.4312" y2="2205.4312"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="353" y="2199.6222">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="371" y="2199.6222">Return result.</text><polygon fill="#181818" points="98,2233.1372,88,2237.1372,98,2241.1372,94,2237.1372" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="92" x2="335" y1="2237.1372" y2="2237.1372"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="104" y="2231.3282">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="122" y="2231.3282">Return result.</text><!--MD5=[2256ae1ef2b3d80ec53b5d224ba3b938]
@startuml

participant "Mojaloop Adapter" as dfsp #B0D5FF
note over dfsp
    * Participant Bank A
    * Participant Bank B
end note

box Central-Ledger #FFFFF9
    participant "**API**" as cl_api
    participant "__api__ / Handler" as cl_handler
    participant "__domain__ / Service" as cl_domain
    participant "__models__ / Facade" as cl_facade

note over cl_api
        NodeJS interface
        invokes REST API
    end note

    note over cl_handler
        JSON request decoded & sent
        for processing via a handler
    end note

    note over cl_domain
        Domain folder where the service
        functions are exposed.
    end note

    note over cl_facade
        Facade for storing/retrieving data from
        MySQL and TigerBeetle
    end note
end box

box Storage #F9FFF9
	participant "TigerBeetle Client" as tb_client #D5E8D4
	collections "TigerBeetle Cluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
	database "Redis" as redis_cache #E1D5E7
end box

autonumber
group Create Transfer (2-Phase)
    dfsp -> cl_api : //JSON// \n**(transfer data)**
    cl_api -> cl_handler : ///jmeter/transfers/prepare// \nHandler invoked
    cl_handler -> cl_domain : Service layer invoked
    cl_domain -> cl_facade : Domain to facade
    cl_facade -> cl_db : Perform the following validations against the database:\n*//validateFspiopSourceMatchesPayer//\n*//validateParticipantByName//\n*//validatePositionAccountByNameAndCurrency//\n*//validateParticipantByName//\n*//validateAmount//\n*//validateConditionAndExpiration//\n*//validateDifferentDfsp//
    cl_facade -> redis_cache : Lookup participant data by \n//name//, //account type// (POSITION) and //currency//.
    autonumber stop
    cl_facade - -> cl_db : If the participant data is not available in Redis, a database lookup is performed
    cl_facade - -> redis_cache : Data looked up is now stored in Redis.
    autonumber resume
    cl_facade -> tb_client : Pending //Transfer// requested via the CL-TB interface.
    tb_client -> tb_nodes : //transfer// Distributed to nodes\n via the state machine.
    tb_nodes -> tb_nodes : **[ASYNC]**\nReplication via VSR.
    tb_client - -> cl_facade : //transfer// create error **(none)**\n//(Replicated to 2 nodes)//
    cl_facade - -> cl_domain : Return result
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_api : Return result
    cl_api - -> dfsp : Return result with //**transferId**//
    == TB and MySQL Database Activities START ==
    cl_facade -> cl_db : *- -//transferDuplicateCheck//- - - -DB record created- -. Built in TB.
    cl_facade -> cl_db : *- -//transfer//,- -Built in TB. \n*- -//transferParticipant//- - Built in TB. \n*//ilpPacket// \n*- -//transferStateChange//- -Built in TB. \n*//transferExtension//\nDatabase records created.
    cl_db <- -> cl_facade : Database transaction committed.
    == TB and MySQL Database Activities STOP ==

||70||

    == Transfer Fulfilment ==
    dfsp -> cl_api : //JSON// \n(fulfil transfer data with //**transferId**//)
    cl_api -> cl_handler : ///jmeter/transfers/fulfil// \nHandler invoked.
    cl_handler -> cl_domain : Service layer invoked \n//handlePayeeResponse//
    cl_domain -> cl_facade : Domain to facade \n//savePayeeTransferResponse//
    cl_facade -> cl_db : New Database transaction for fulfillment.
    cl_facade -> cl_db : Obtain //**settlementWindowId**// for window where state is **OPEN**.
    cl_facade -> tb_client : //Transfer// posting requested via the CL-TB interface.
    tb_client -> tb_nodes : //transfer// Distributed to nodes\n via the state machine.
    tb_nodes -> tb_nodes : **[ASYNC]**\nReplication via VSR.
    tb_client - -> cl_facade : //transfer// posting create error **(none)**\n//(Replicated to 2 nodes)//.
    cl_facade -> cl_db : Create \n*- -//transferFulfilment//- - Built in TB. \n*- -//transferStateChange//- - Built in TB. \nDatabase records.
    cl_facade -> cl_db : Database transaction committed.
    cl_facade - -> cl_domain : Return result.
    cl_domain - -> cl_handler : Return result.
    cl_handler - -> cl_api : Return result.
    cl_api - -> dfsp : Return result.
end

@enduml

PlantUML version 1.2022.6(Tue Jun 21 19:34:49 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>