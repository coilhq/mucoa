<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1117.6px" preserveAspectRatio="none" style="width:912px;height:1117px;background:#FFFFFF;" version="1.1" viewBox="0 0 912 1117" width="912.8px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="1102.4313" style="stroke:#181818;stroke-width:0.4000000000000001;" width="350.8" x="160" y="4.8"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="76" x="295.8" y="15.5961">Central-Ledger</text><rect fill="#F9FFF9" height="1102.4313" style="stroke:#181818;stroke-width:0.4000000000000001;" width="322.4" x="572" y="4.8"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="40" x="711.6" y="15.5961">Storage</text><rect height="786.125" style="stroke:#000000;stroke-width:1.2000000000000002;fill:none;" width="880.8" x="18.4" y="254.2188"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="54.4" x2="54.4" y1="71.9688" y2="1053.9438"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="194.4" x2="194.4" y1="71.9688" y2="1053.9438"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="294" x2="294" y1="71.9688" y2="1053.9438"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="434.8" x2="434.8" y1="71.9688" y2="1053.9438"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="609.6" x2="609.6" y1="71.9688" y2="1053.9438"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="763.2" x2="763.2" y1="71.9688" y2="1053.9438"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="828.8" x2="828.8" y1="71.9688" y2="1053.9438"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="874.4" x2="874.4" y1="71.9688" y2="1053.9438"/><rect fill="#B0D5FF" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="56.8" x="26.4" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="32" y="49.0203">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="40" x="34.8" y="63.1078">Adapter</text><rect fill="#B0D5FF" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="56.8" x="26.4" y="1053.1438"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="32" y="1070.3703">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="40" x="34.8" y="1084.4578">Adapter</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="63.2" x="163.2" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="180.4" y="49.0203">Kafka</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="52" x="168.8" y="63.1078">Consumer</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="63.2" x="163.2" y="1053.1438"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="180.4" y="1070.3703">Kafka</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="52" x="168.8" y="1084.4578">Consumer</text><rect fill="#E2E2F0" height="25.2875" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="75.2" x="256.4" y="45.8813"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" text-decoration="underline" textLength="15.2" x="262" y="63.1078">api</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="280.4" y="63.1078">/ Handler</text><rect fill="#E2E2F0" height="25.2875" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="75.2" x="256.4" y="1053.1438"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" text-decoration="underline" textLength="15.2" x="262" y="1070.3703">api</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="280.4" y="1070.3703">/ Handler</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="145.6" x="362" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="87.2" x="391.2" y="49.0203">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="134.4" x="367.6" y="63.1078">(domain / service / facade)</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="145.6" x="362" y="1053.1438"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="87.2" x="391.2" y="1070.3703">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="134.4" x="367.6" y="1084.4578">(domain / service / facade)</text><rect fill="#D5E8D4" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="575.2" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="580.8" y="49.0203">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="595.6" y="63.1078">Client</text><rect fill="#D5E8D4" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="575.2" y="1053.1438"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="580.8" y="1070.3703">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="595.6" y="1084.4578">Client</text><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="730.4" y="28.5938"/><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="727.2" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="732.8" y="49.0203">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36" x="744" y="63.1078">Cluster</text><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="730.4" y="1053.1438"/><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="727.2" y="1056.3438"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="732.8" y="1073.5703">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36" x="744" y="1087.6578">Cluster</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36.8" x="808" y="69.5078">MySQL</text><path d="M814.4,29.0813 C814.4,21.0813 828.8,21.0813 828.8,21.0813 C828.8,21.0813 843.2,21.0813 843.2,29.0813 L843.2,49.8813 C843.2,57.8813 828.8,57.8813 828.8,57.8813 C828.8,57.8813 814.4,57.8813 814.4,49.8813 L814.4,29.0813 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M814.4,29.0813 C814.4,37.0813 828.8,37.0813 828.8,37.0813 C828.8,37.0813 843.2,37.0813 843.2,29.0813 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36.8" x="808" y="1064.7703">MySQL</text><path d="M814.4,1075.2313 C814.4,1067.2313 828.8,1067.2313 828.8,1067.2313 C828.8,1067.2313 843.2,1067.2313 843.2,1075.2313 L843.2,1096.0313 C843.2,1104.0313 828.8,1104.0313 828.8,1104.0313 C828.8,1104.0313 814.4,1104.0313 814.4,1096.0313 L814.4,1075.2313 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M814.4,1075.2313 C814.4,1083.2313 828.8,1083.2313 828.8,1083.2313 C828.8,1083.2313 843.2,1083.2313 843.2,1075.2313 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="857.6" y="69.5078">Redis</text><path d="M860,29.0813 C860,21.0813 874.4,21.0813 874.4,21.0813 C874.4,21.0813 888.8,21.0813 888.8,29.0813 L888.8,49.8813 C888.8,57.8813 874.4,57.8813 874.4,57.8813 C874.4,57.8813 860,57.8813 860,49.8813 L860,29.0813 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M860,29.0813 C860,37.0813 874.4,37.0813 874.4,37.0813 C874.4,37.0813 888.8,37.0813 888.8,29.0813 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="857.6" y="1064.7703">Redis</text><path d="M860,1075.2313 C860,1067.2313 874.4,1067.2313 874.4,1067.2313 C874.4,1067.2313 888.8,1067.2313 888.8,1075.2313 L888.8,1096.0313 C888.8,1104.0313 874.4,1104.0313 874.4,1104.0313 C874.4,1104.0313 860,1104.0313 860,1096.0313 L860,1075.2313 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M860,1075.2313 C860,1083.2313 874.4,1083.2313 874.4,1083.2313 C874.4,1083.2313 888.8,1083.2313 888.8,1075.2313 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M4,83.9688 L4,117.5688 L105.6,117.5688 L105.6,91.9688 L97.6,83.9688 L4,83.9688 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M97.6,83.9688 L97.6,91.9688 L105.6,91.9688 L97.6,83.9688 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="49.6" x="8.8" y="98.7648">Participant</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="84.8" x="8.8" y="111.8461">DFSP interactions</text><path d="M127.2,126.1313 L127.2,159.7313 L262.4,159.7313 L262.4,134.1313 L254.4,126.1313 L127.2,126.1313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M254.4,126.1313 L254.4,134.1313 L262.4,134.1313 L254.4,126.1313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="74.4" x="132" y="140.9273">Consume JSON</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="118.4" x="132" y="154.0086">requests from Kafka topic</text><path d="M226.4,168.2938 L226.4,201.8938 L360.8,201.8938 L360.8,176.2938 L352.8,168.2938 L226.4,168.2938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M352.8,168.2938 L352.8,176.2938 L360.8,176.2938 L352.8,168.2938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="117.6" x="231.2" y="183.0898">JSON request decoded &amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="100" x="231.2" y="196.1711">processed via handler</text><path d="M360,210.4563 L360,244.0563 L509.6,244.0563 L509.6,218.4563 L501.6,210.4563 L360,210.4563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M501.6,210.4563 L501.6,218.4563 L509.6,218.4563 L501.6,210.4563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="125.6" x="364.8" y="225.2523">Expose service functions &amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="132.8" x="364.8" y="238.3336">handle database interactions</text><path d="M18.4,254.2188 L182.4,254.2188 L182.4,260.9 L174.4,268.9 L18.4,268.9 L18.4,254.2188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.2000000000000002;"/><rect fill="none" height="786.125" style="stroke:#000000;stroke-width:1.2000000000000002;" width="880.8" x="18.4" y="254.2188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="128" x="30.4" y="265.8148">Create Transfer (2-Phase)</text><rect fill="#EEEEEE" height="2.4" style="stroke:#EEEEEE;stroke-width:0.8000000000000002;" width="907.2" x="0" y="285.8406"/><line style="stroke:#000000;stroke-width:0.8000000000000002;" x1="0" x2="907.2" y1="285.8406" y2="285.8406"/><line style="stroke:#000000;stroke-width:0.8000000000000002;" x1="0" x2="907.2" y1="288.2406" y2="288.2406"/><rect fill="#EEEEEE" height="19.4813" style="stroke:#000000;stroke-width:1.6000000000000003;" width="100" x="403.6" y="276.9"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="85.6" x="408.4" y="290.8961">Prepare Transfer</text><polygon fill="#181818" points="185.2,332.1438,193.2,335.3438,185.2,338.5438,188.4,335.3438" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="54.8" x2="190" y1="335.3438" y2="335.3438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="60.4" y="324.918">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="28" x="69.2" y="318.3773">JSON</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="97.2" y="318.3773"> </text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="69.2" y="331.4586">(</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="38.4" x="72.4" y="331.4586">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="114" y="331.4586">-</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="34.4" x="120.4" y="331.4586">prepare</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="23.2" x="158" y="331.4586">data)</text><polygon fill="#181818" points="284.4,356.425,292.4,359.625,284.4,362.825,287.6,359.625" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="194.8" x2="289.2" y1="359.625" y2="359.625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="200.4" y="355.7398">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="65.6" x="209.2" y="355.7398">Invoke handler</text><polygon fill="#181818" points="425.2,380.7063,433.2,383.9063,425.2,387.1063,428.4,383.9063" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="294" x2="430" y1="383.9063" y2="383.9063"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="299.6" y="380.0211">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="107.2" x="308.4" y="380.0211">Invoke application layer</text><polygon fill="#181818" points="819.2,404.9875,827.2,408.1875,819.2,411.3875,822.4,408.1875" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="434.8" x2="824" y1="408.1875" y2="408.1875"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="440.4" y="404.3023">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="183.2" x="449.2" y="404.3023">Validate pending transfer data elements</text><polygon fill="#181818" points="443.6,429.2688,435.6,432.4688,443.6,435.6688,440.4,432.4688" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="864.8,429.2688,872.8,432.4688,864.8,435.6688,868,432.4688" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="438.8" x2="869.6" y1="432.4688" y2="432.4688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="448.4" y="428.5836">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="164" x="457.2" y="428.5836">Lookup Participant data from cache</text><polygon fill="#181818" points="443.6,466.6313,435.6,469.8313,443.6,473.0313,440.4,469.8313" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="819.2,466.6313,827.2,469.8313,819.2,473.0313,822.4,469.8313" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="438.8" x2="824" y1="469.8313" y2="469.8313"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="138.4" x="448.4" y="452.8648">If Participant data not cached,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="148.8" x="448.4" y="465.9461">then retrieve from SQL database</text><polygon fill="#181818" points="864.8,503.9938,872.8,507.1938,864.8,510.3938,868,507.1938" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="434.8" x2="869.6" y1="507.1938" y2="507.1938"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="111.2" x="440.4" y="490.2273">If not previously cached,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="127.2" x="440.4" y="503.3086">then cache Participant data</text><polygon fill="#181818" points="600.4,528.275,608.4,531.475,600.4,534.675,603.6,531.475" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="434.8" x2="605.2" y1="531.475" y2="531.475"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="440.4" y="527.5898">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="77.6" x="449.2" y="527.5898">Request pending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="530" y="527.5898">transfer</text><polygon fill="#181818" points="618.8,565.6375,610.8,568.8375,618.8,572.0375,615.6,568.8375" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="754,565.6375,762,568.8375,754,572.0375,757.2,568.8375" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="614" x2="758.8" y1="568.8375" y2="568.8375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="623.6" y="558.4117">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="122.4" x="632.4" y="551.8711">Check duplicates &amp; create</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="632.4" y="564.9523">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="74.4" x="670.8" y="564.9523">prepare account</text><polygon fill="#181818" points="443.6,589.9188,435.6,593.1188,443.6,596.3188,440.4,593.1188" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="438.8" x2="609.2" y1="593.1188" y2="593.1188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="448.4" y="589.2336">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="457.2" y="589.2336">Return</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="490.8" y="589.2336">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="57.6" x="529.2" y="589.2336">create result</text><polygon fill="#181818" points="443.6,627.2813,435.6,630.4813,443.6,633.6813,440.4,630.4813" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="819.2,627.2813,827.2,630.4813,819.2,633.6813,822.4,630.4813" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="438.8" x2="824" y1="630.4813" y2="630.4813"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="448.4" y="620.0555">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="457.2" y="613.5148">Create</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="490.8" y="613.5148">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="103.2" x="529.2" y="613.5148">prepare &amp; return result</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="26.4" x="457.2" y="626.5961">(store</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="44" x="486.8" y="626.5961">ilpPacket</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="7.2" x="534" y="626.5961">&amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="80.8" x="544.4" y="626.5961">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="45.6" x="628.4" y="626.5961">data only)</text><polygon fill="#181818" points="302.8,651.5625,294.8,654.7625,302.8,657.9625,299.6,654.7625" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="298" x2="434" y1="654.7625" y2="654.7625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="307.6" y="650.8773">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="59.2" x="322" y="650.8773">Return result</text><polygon fill="#181818" points="203.6,675.8438,195.6,679.0438,203.6,682.2438,200.4,679.0438" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="198.8" x2="293.2" y1="679.0438" y2="679.0438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="208.4" y="675.1586">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="59.2" x="222.8" y="675.1586">Return result</text><polygon fill="#181818" points="63.6,700.125,55.6,703.325,63.6,706.525,60.4,703.325" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="58.8" x2="194" y1="703.325" y2="703.325"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="68.4" y="699.4398">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="82.8" y="699.4398">Return</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="45.6" x="116.4" y="699.4398">transferId</text><rect fill="#EEEEEE" height="2.4" style="stroke:#EEEEEE;stroke-width:0.8000000000000002;" width="907.2" x="0" y="726.6656"/><line style="stroke:#000000;stroke-width:0.8000000000000002;" x1="0" x2="907.2" y1="726.6656" y2="726.6656"/><line style="stroke:#000000;stroke-width:0.8000000000000002;" x1="0" x2="907.2" y1="729.0656" y2="729.0656"/><rect fill="#EEEEEE" height="19.4813" style="stroke:#000000;stroke-width:1.6000000000000003;" width="84.8" x="411.2" y="717.725"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="70.4" x="416" y="731.7211">Fulfil Transfer</text><polygon fill="#181818" points="185.2,772.9688,193.2,776.1688,185.2,779.3688,188.4,776.1688" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="54.8" x2="190" y1="776.1688" y2="776.1688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="60.4" y="765.743">13</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="28" x="74.8" y="759.2023">JSON</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="102.8" y="759.2023"> </text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="74.8" y="772.2836">(</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="38.4" x="78" y="772.2836">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="50.4" x="119.6" y="772.2836">- fulfil data)</text><polygon fill="#181818" points="284.4,797.25,292.4,800.45,284.4,803.65,287.6,800.45" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="194.8" x2="289.2" y1="800.45" y2="800.45"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="200.4" y="796.5648">14</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="65.6" x="214.8" y="796.5648">Invoke handler</text><polygon fill="#181818" points="425.2,821.5313,433.2,824.7313,425.2,827.9313,428.4,824.7313" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="294" x2="430" y1="824.7313" y2="824.7313"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="299.6" y="820.8461">15</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="107.2" x="314" y="820.8461">Invoke application layer</text><polygon fill="#181818" points="443.6,858.8938,435.6,862.0938,443.6,865.2938,440.4,862.0938" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="819.2,858.8938,827.2,862.0938,819.2,865.2938,822.4,862.0938" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="438.8" x2="824" y1="862.0938" y2="862.0938"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="448.4" y="851.668">16</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="462.8" y="845.1273">Create</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="496.4" y="845.1273">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="53.6" x="534.8" y="845.1273">fulfillment &amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="142.4" x="462.8" y="858.2086">obtain open settlement window</text><polygon fill="#181818" points="600.4,883.175,608.4,886.375,600.4,889.575,603.6,886.375" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="434.8" x2="605.2" y1="886.375" y2="886.375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="440.4" y="882.4898">17</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="78.4" x="454.8" y="882.4898">Post the pending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="536.4" y="882.4898">transfer</text><polygon fill="#181818" points="754,920.5375,762,923.7375,754,926.9375,757.2,923.7375" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="610" x2="758.8" y1="923.7375" y2="923.7375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="615.6" y="913.3117">18</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="60.8" x="630" y="906.7711">Fulfil pending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="694" y="906.7711">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="729.2" y="906.7711"> </text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="116" x="630" y="919.8523">(update status to posted)</text><polygon fill="#181818" points="443.6,944.8188,435.6,948.0188,443.6,951.2188,440.4,948.0188" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="438.8" x2="609.2" y1="948.0188" y2="948.0188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="448.4" y="944.1336">19</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="462.8" y="944.1336">Return</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="496.4" y="944.1336">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="69.6" x="534.8" y="944.1336">fulfilment result</text><polygon fill="#181818" points="302.8,969.1,294.8,972.3,302.8,975.5,299.6,972.3" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="298" x2="434" y1="972.3" y2="972.3"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="307.6" y="968.4148">20</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="59.2" x="322" y="968.4148">Return result</text><polygon fill="#181818" points="203.6,993.3813,195.6,996.5813,203.6,999.7813,200.4,996.5813" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="198.8" x2="293.2" y1="996.5813" y2="996.5813"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="208.4" y="992.6961">21</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="59.2" x="222.8" y="992.6961">Return result</text><polygon fill="#181818" points="63.6,1030.7438,55.6,1033.9438,63.6,1037.1438,60.4,1033.9438" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="58.8" x2="194" y1="1033.9438" y2="1033.9438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="68.4" y="1023.518">22</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="68" x="82.8" y="1016.9773">Return transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="69.6" x="82.8" y="1030.0586">fulfilment result</text><!--MD5=[5b0267e932cc3ffb46df4cce5149809c]
@startuml

participant "Mojaloop\nAdapter" as dfsp #B0D5FF
note over dfsp
    Participant
    DFSP interactions
end note

box Central-Ledger #FFFFF9
    participant "Kafka\nConsumer" as cl_consume_kafka
    participant "__api__ / Handler" as cl_handler
    participant "Application Layer\n(domain / service / facade)" as cl_domain

        note over cl_consume_kafka
            Consume JSON
            requests from Kafka topic
        end note

        note over cl_handler
            JSON request decoded &
            processed via handler
        end note

        note over cl_domain
            Expose service functions &
            handle database interactions
        end note
end box

box Storage #F9FFF9
	participant "TigerBeetle\nClient" as tb_client #D5E8D4
	collections "TigerBeetle\nCluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
	database "Redis" as redis_cache #E1D5E7
end box

autonumber
group Create Transfer (2-Phase)
    == Prepare Transfer ==
    dfsp -> cl_consume_kafka : //JSON// \n(**transfer** - //prepare// data)
    cl_consume_kafka -> cl_handler : Invoke handler
    cl_handler -> cl_domain : Invoke application layer
    cl_domain -> cl_db : Validate pending transfer data elements
    cl_domain <- -> redis_cache : Lookup Participant data from cache
    autonumber stop

    cl_domain <- -> cl_db : If Participant data not cached, \nthen retrieve from SQL database
    cl_domain -> redis_cache : If not previously cached, \nthen cache Participant data

    autonumber resume

    cl_domain -> tb_client : Request pending //transfer//
    tb_client <- -> tb_nodes : Check duplicates & create \n//transfer// prepare account
    tb_client - -> cl_domain : Return //transfer// create result
    cl_domain <- -> cl_db : Create //transfer// prepare & return result \n(store //ilpPacket// & //transferExtension// data only)
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_consume_kafka : Return result
    cl_consume_kafka - -> dfsp : Return //**transferId**//

    == Fulfil Transfer ==
    dfsp -> cl_consume_kafka : //JSON// \n(**transfer** - fulfil data)
    cl_consume_kafka -> cl_handler : Invoke handler
    cl_handler -> cl_domain : Invoke application layer
    cl_domain <- -> cl_db : Create //transfer// fulfillment & \nobtain open settlement window
    cl_domain -> tb_client : Post the pending //transfer//
    tb_client -> tb_nodes : Fulfil pending //transfer// \n(update status to posted)
    tb_client - -> cl_domain : Return //transfer// fulfilment result
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_consume_kafka : Return result
    cl_consume_kafka - -> dfsp : Return transfer \nfulfilment result
end

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CAT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>