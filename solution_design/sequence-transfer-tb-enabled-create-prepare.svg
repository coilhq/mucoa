<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="786.4px" preserveAspectRatio="none" style="width:884px;height:786px;background:#FFFFFF;" version="1.1" viewBox="0 0 884 786" width="884px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFF9" height="771.8125" style="stroke:#181818;stroke-width:0.4000000000000001;" width="339.6" x="160" y="4.8"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="76" x="290.2" y="15.5961">Central-Ledger</text><rect fill="#F9FFF9" height="771.8125" style="stroke:#181818;stroke-width:0.4000000000000001;" width="322.4" x="543.2" y="4.8"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="40" x="682.8" y="15.5961">Storage</text><rect height="455.5063" style="stroke:#000000;stroke-width:1.2000000000000002;fill:none;" width="852" x="18.4" y="254.2188"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="54.4" x2="54.4" y1="71.9688" y2="723.325"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="194.4" x2="194.4" y1="71.9688" y2="723.325"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="288.4" x2="288.4" y1="71.9688" y2="723.325"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="423.6" x2="423.6" y1="71.9688" y2="723.325"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="580.8" x2="580.8" y1="71.9688" y2="723.325"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="734.4" x2="734.4" y1="71.9688" y2="723.325"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="800" x2="800" y1="71.9688" y2="723.325"/><line style="stroke:#181818;stroke-width:0.4000000000000001;fill:none;stroke-dasharray:5.0,5.0;" x1="845.6" x2="845.6" y1="71.9688" y2="723.325"/><rect fill="#B0D5FF" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="56.8" x="26.4" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="32" y="49.0203">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="40" x="34.8" y="63.1078">Adapter</text><rect fill="#B0D5FF" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="56.8" x="26.4" y="722.525"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="32" y="739.7516">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="40" x="34.8" y="753.8391">Adapter</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="63.2" x="163.2" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="180.4" y="49.0203">Kafka</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="52" x="168.8" y="63.1078">Consumer</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="63.2" x="163.2" y="722.525"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="180.4" y="739.7516">Kafka</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="52" x="168.8" y="753.8391">Consumer</text><rect fill="#E2E2F0" height="25.2875" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="75.2" x="250.8" y="45.8813"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" text-decoration="underline" textLength="15.2" x="256.4" y="63.1078">api</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="274.8" y="63.1078">/ Handler</text><rect fill="#E2E2F0" height="25.2875" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="75.2" x="250.8" y="722.525"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" text-decoration="underline" textLength="15.2" x="256.4" y="739.7516">api</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="45.6" x="274.8" y="739.7516">/ Handler</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="145.6" x="350.8" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="87.2" x="380" y="49.0203">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="134.4" x="356.4" y="63.1078">(domain / service / facade)</text><rect fill="#E2E2F0" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="145.6" x="350.8" y="722.525"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="87.2" x="380" y="739.7516">Application Layer</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="134.4" x="356.4" y="753.8391">(domain / service / facade)</text><rect fill="#D5E8D4" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="546.4" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="552" y="49.0203">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="566.8" y="63.1078">Client</text><rect fill="#D5E8D4" height="39.375" rx="2" ry="2" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="546.4" y="722.525"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="552" y="739.7516">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="566.8" y="753.8391">Client</text><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="701.6" y="28.5938"/><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="698.4" y="31.7938"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="704" y="49.0203">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36" x="715.2" y="63.1078">Cluster</text><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="701.6" y="722.525"/><rect fill="#D5E8D4" height="39.375" style="stroke:#181818;stroke-width:0.4000000000000001;" width="69.6" x="698.4" y="725.725"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="58.4" x="704" y="742.9516">TigerBeetle</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36" x="715.2" y="757.0391">Cluster</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36.8" x="779.2" y="69.5078">MySQL</text><path d="M785.6,29.0813 C785.6,21.0813 800,21.0813 800,21.0813 C800,21.0813 814.4,21.0813 814.4,29.0813 L814.4,49.8813 C814.4,57.8813 800,57.8813 800,57.8813 C800,57.8813 785.6,57.8813 785.6,49.8813 L785.6,29.0813 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M785.6,29.0813 C785.6,37.0813 800,37.0813 800,37.0813 C800,37.0813 814.4,37.0813 814.4,29.0813 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="36.8" x="779.2" y="734.1516">MySQL</text><path d="M785.6,744.6125 C785.6,736.6125 800,736.6125 800,736.6125 C800,736.6125 814.4,736.6125 814.4,744.6125 L814.4,765.4125 C814.4,773.4125 800,773.4125 800,773.4125 C800,773.4125 785.6,773.4125 785.6,765.4125 L785.6,744.6125 " fill="#DAE8FC" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M785.6,744.6125 C785.6,752.6125 800,752.6125 800,752.6125 C800,752.6125 814.4,752.6125 814.4,744.6125 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="828.8" y="69.5078">Redis</text><path d="M831.2,29.0813 C831.2,21.0813 845.6,21.0813 845.6,21.0813 C845.6,21.0813 860,21.0813 860,29.0813 L860,49.8813 C860,57.8813 845.6,57.8813 845.6,57.8813 C845.6,57.8813 831.2,57.8813 831.2,49.8813 L831.2,29.0813 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M831.2,29.0813 C831.2,37.0813 845.6,37.0813 845.6,37.0813 C845.6,37.0813 860,37.0813 860,29.0813 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacing" textLength="28.8" x="828.8" y="734.1516">Redis</text><path d="M831.2,744.6125 C831.2,736.6125 845.6,736.6125 845.6,736.6125 C845.6,736.6125 860,736.6125 860,744.6125 L860,765.4125 C860,773.4125 845.6,773.4125 845.6,773.4125 C845.6,773.4125 831.2,773.4125 831.2,765.4125 L831.2,744.6125 " fill="#E1D5E7" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M831.2,744.6125 C831.2,752.6125 845.6,752.6125 845.6,752.6125 C845.6,752.6125 860,752.6125 860,744.6125 " fill="none" style="stroke:#181818;stroke-width:1.2000000000000002;"/><path d="M4,83.9688 L4,117.5688 L105.6,117.5688 L105.6,91.9688 L97.6,83.9688 L4,83.9688 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M97.6,83.9688 L97.6,91.9688 L105.6,91.9688 L97.6,83.9688 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="49.6" x="8.8" y="98.7648">Participant</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="84.8" x="8.8" y="111.8461">DFSP interactions</text><path d="M127.2,126.1313 L127.2,159.7313 L262.4,159.7313 L262.4,134.1313 L254.4,126.1313 L127.2,126.1313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M254.4,126.1313 L254.4,134.1313 L262.4,134.1313 L254.4,126.1313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="74.4" x="132" y="140.9273">Consume JSON</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="118.4" x="132" y="154.0086">requests from Kafka topic</text><path d="M220.8,168.2938 L220.8,201.8938 L355.2,201.8938 L355.2,176.2938 L347.2,168.2938 L220.8,168.2938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M347.2,168.2938 L347.2,176.2938 L355.2,176.2938 L347.2,168.2938 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="117.6" x="225.6" y="183.0898">JSON request decoded &amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="100" x="225.6" y="196.1711">processed via handler</text><path d="M348.8,210.4563 L348.8,244.0563 L498.4,244.0563 L498.4,218.4563 L490.4,210.4563 L348.8,210.4563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><path d="M490.4,210.4563 L490.4,218.4563 L498.4,218.4563 L490.4,210.4563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="125.6" x="353.6" y="225.2523">Expose service functions &amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="132.8" x="353.6" y="238.3336">handle database interactions</text><path d="M18.4,254.2188 L182.4,254.2188 L182.4,260.9 L174.4,268.9 L18.4,268.9 L18.4,254.2188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.2000000000000002;"/><rect fill="none" height="455.5063" style="stroke:#000000;stroke-width:1.2000000000000002;" width="852" x="18.4" y="254.2188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="128" x="30.4" y="265.8148">Create Transfer (2-Phase)</text><rect fill="#EEEEEE" height="2.4" style="stroke:#EEEEEE;stroke-width:0.8000000000000002;" width="878.4" x="0" y="285.8406"/><line style="stroke:#000000;stroke-width:0.8000000000000002;" x1="0" x2="878.4" y1="285.8406" y2="285.8406"/><line style="stroke:#000000;stroke-width:0.8000000000000002;" x1="0" x2="878.4" y1="288.2406" y2="288.2406"/><rect fill="#EEEEEE" height="19.4813" style="stroke:#000000;stroke-width:1.6000000000000003;" width="100" x="389.2" y="276.9"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="85.6" x="394" y="290.8961">Prepare Transfer</text><polygon fill="#181818" points="185.2,332.1438,193.2,335.3438,185.2,338.5438,188.4,335.3438" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="54.8" x2="190" y1="335.3438" y2="335.3438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="60.4" y="324.918">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="28" x="69.2" y="318.3773">JSON</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="97.2" y="318.3773"> </text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="69.2" y="331.4586">(</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="38.4" x="72.4" y="331.4586">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="3.2" x="114" y="331.4586">-</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="34.4" x="120.4" y="331.4586">prepare</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="23.2" x="158" y="331.4586">data)</text><polygon fill="#181818" points="278.8,356.425,286.8,359.625,278.8,362.825,282,359.625" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="194.8" x2="283.6" y1="359.625" y2="359.625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="200.4" y="355.7398">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="65.6" x="209.2" y="355.7398">Invoke handler</text><polygon fill="#181818" points="414,380.7063,422,383.9063,414,387.1063,417.2,383.9063" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="288.4" x2="418.8" y1="383.9063" y2="383.9063"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="294" y="380.0211">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="107.2" x="302.8" y="380.0211">Invoke application layer</text><polygon fill="#181818" points="790.4,404.9875,798.4,408.1875,790.4,411.3875,793.6,408.1875" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="423.6" x2="795.2" y1="408.1875" y2="408.1875"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="429.2" y="404.3023">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="76.8" x="438" y="404.3023">Validate pending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="518" y="404.3023">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="65.6" x="556.4" y="404.3023">data elements</text><polygon fill="#181818" points="432.4,429.2688,424.4,432.4688,432.4,435.6688,429.2,432.4688" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="836,429.2688,844,432.4688,836,435.6688,839.2,432.4688" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="427.6" x2="840.8" y1="432.4688" y2="432.4688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="437.2" y="428.5836">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="164" x="446" y="428.5836">Lookup Participant data from cache</text><polygon fill="#181818" points="432.4,466.6313,424.4,469.8313,432.4,473.0313,429.2,469.8313" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="790.4,466.6313,798.4,469.8313,790.4,473.0313,793.6,469.8313" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="427.6" x2="795.2" y1="469.8313" y2="469.8313"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="138.4" x="437.2" y="452.8648">If Participant data not cached,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="148.8" x="437.2" y="465.9461">then retrieve from SQL database</text><polygon fill="#181818" points="836,503.9938,844,507.1938,836,510.3938,839.2,507.1938" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="423.6" x2="840.8" y1="507.1938" y2="507.1938"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="111.2" x="429.2" y="490.2273">If not previously cached,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="127.2" x="429.2" y="503.3086">then cache Participant data</text><polygon fill="#181818" points="571.6,528.275,579.6,531.475,571.6,534.675,574.8,531.475" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;" x1="423.6" x2="576.4" y1="531.475" y2="531.475"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="429.2" y="527.5898">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="77.6" x="438" y="527.5898">Request pending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="518.8" y="527.5898">transfer</text><polygon fill="#181818" points="590,565.6375,582,568.8375,590,572.0375,586.8,568.8375" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="725.2,565.6375,733.2,568.8375,725.2,572.0375,728.4,568.8375" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="585.2" x2="730" y1="568.8375" y2="568.8375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="594.8" y="558.4117">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="122.4" x="603.6" y="551.8711">Check duplicates &amp; create</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="603.6" y="564.9523">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="74.4" x="642" y="564.9523">prepare account</text><polygon fill="#181818" points="432.4,589.9188,424.4,593.1188,432.4,596.3188,429.2,593.1188" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="427.6" x2="580.4" y1="593.1188" y2="593.1188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="437.2" y="589.2336">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="446" y="589.2336">Return</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="479.6" y="589.2336">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="57.6" x="518" y="589.2336">create result</text><polygon fill="#181818" points="432.4,627.2813,424.4,630.4813,432.4,633.6813,429.2,630.4813" style="stroke:#181818;stroke-width:0.8000000000000002;"/><polygon fill="#181818" points="790.4,627.2813,798.4,630.4813,790.4,633.6813,793.6,630.4813" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="427.6" x2="795.2" y1="630.4813" y2="630.4813"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="437.2" y="620.0555">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="446" y="613.5148">Create</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="35.2" x="479.6" y="613.5148">transfer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="103.2" x="518" y="613.5148">prepare &amp; return result</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="26.4" x="446" y="626.5961">(store</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="44" x="475.6" y="626.5961">ilpPacket</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="7.2" x="522.8" y="626.5961">&amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" lengthAdjust="spacing" textLength="80.8" x="533.2" y="626.5961">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="45.6" x="617.2" y="626.5961">data only)</text><polygon fill="#181818" points="297.2,651.5625,289.2,654.7625,297.2,657.9625,294,654.7625" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="292.4" x2="422.8" y1="654.7625" y2="654.7625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="302" y="650.8773">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="59.2" x="316.4" y="650.8773">Return result</text><polygon fill="#181818" points="203.6,675.8438,195.6,679.0438,203.6,682.2438,200.4,679.0438" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="198.8" x2="287.6" y1="679.0438" y2="679.0438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="208.4" y="675.1586">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="59.2" x="222.8" y="675.1586">Return result</text><polygon fill="#181818" points="63.6,700.125,55.6,703.325,63.6,706.525,60.4,703.325" style="stroke:#181818;stroke-width:0.8000000000000002;"/><line style="stroke:#181818;stroke-width:0.8000000000000002;stroke-dasharray:2.0,2.0;" x1="58.8" x2="194" y1="703.325" y2="703.325"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="68.4" y="699.4398">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacing" textLength="30.4" x="82.8" y="699.4398">Return</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="45.6" x="116.4" y="699.4398">transferId</text><!--MD5=[fb070184512496b2bc5e89906065327e]
@startuml

participant "Mojaloop\nAdapter" as dfsp #B0D5FF
note over dfsp
    Participant
    DFSP interactions
end note

box Central-Ledger #FFFFF9
    participant "Kafka\nConsumer" as cl_consume_kafka
    participant "__api__ / Handler" as cl_handler
    participant "Application Layer\n(domain / service / facade)" as cl_domain

        note over cl_consume_kafka
            Consume JSON
            requests from Kafka topic
        end note

        note over cl_handler
            JSON request decoded &
            processed via handler
        end note

        note over cl_domain
            Expose service functions &
            handle database interactions
        end note
end box

box Storage #F9FFF9
	participant "TigerBeetle\nClient" as tb_client #D5E8D4
	collections "TigerBeetle\nCluster" as tb_nodes #D5E8D4
	database "MySQL" as cl_db #DAE8FC
	database "Redis" as redis_cache #E1D5E7
end box

autonumber
group Create Transfer (2-Phase)
    == Prepare Transfer ==
    dfsp -> cl_consume_kafka : //JSON// \n(**transfer** - //prepare// data)
    cl_consume_kafka -> cl_handler : Invoke handler
    cl_handler -> cl_domain : Invoke application layer
    cl_domain -> cl_db : Validate pending //transfer// data elements
    cl_domain <- -> redis_cache : Lookup Participant data from cache
    autonumber stop

    cl_domain <- -> cl_db : If Participant data not cached, \nthen retrieve from SQL database
    cl_domain -> redis_cache : If not previously cached, \nthen cache Participant data

    autonumber resume

    cl_domain -> tb_client : Request pending //transfer//
    tb_client <- -> tb_nodes : Check duplicates & create \n//transfer// prepare account
    tb_client - -> cl_domain : Return //transfer// create result
    cl_domain <- -> cl_db : Create //transfer// prepare & return result \n(store //ilpPacket// & //transferExtension// data only)
    cl_domain - -> cl_handler : Return result
    cl_handler - -> cl_consume_kafka : Return result
    cl_consume_kafka - -> dfsp : Return //**transferId**//

end

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CAT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>